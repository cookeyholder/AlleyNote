PHPUnit 11.5.34 by Sebastian Bergmann and contributors.

Runtime:       PHP 8.4.11
Configuration: /var/www/html/phpunit.xml

.............................................................   61 / 1162 (  5%)
.............................................................  122 / 1162 ( 10%)
......................................F.....................F  183 / 1162 ( 15%)
............................F................................  244 / 1162 ( 20%)
.............................................................  305 / 1162 ( 26%)
.............................................................  366 / 1162 ( 31%)
.............................................................  427 / 1162 ( 36%)
........EEEFEEEEEEEEEFEEEEEEEEEEEE...E.......................  488 / 1162 ( 41%)
.............................................................  549 / 1162 ( 47%)
.............................................................  610 / 1162 ( 52%)
.............................................................  671 / 1162 ( 57%)
.............................................................  732 / 1162 ( 62%)
.............................................................  793 / 1162 ( 68%)
......SS...........SSSSSSSSSSS....F..........................  854 / 1162 ( 73%)
.............................................................  915 / 1162 ( 78%)
.............................................................  976 / 1162 ( 83%)
.........................................................EEEE 1037 / 1162 ( 89%)
E......................................S...................EE 1098 / 1162 ( 94%)
EE.FEEEEEEEE.........................................EE.F.... 1159 / 1162 ( 99%)
...                                                           1162 / 1162 (100%)

Time: 00:15.513, Memory: 37.00 MB

There were 44 errors:

1) Tests\Unit\Domains\Auth\Services\JwtTokenServiceTest::test_generateTokenPair_should_throw_exception_when_jwt_provider_fails
Error: Call to a member function expects() on null

/var/www/html/tests/Unit/Domains/Auth/Services/JwtTokenServiceTest.php:103

2) Tests\Unit\Domains\Auth\Services\JwtTokenServiceTest::test_generateTokenPair_should_throw_exception_when_repository_fails
Error: Call to a member function expects() on null

/var/www/html/tests/Unit/Domains/Auth/Services/JwtTokenServiceTest.php:118

3) Tests\Unit\Domains\Auth\Services\JwtTokenServiceTest::test_validateAccessToken_should_return_payload_when_valid_token
Error: Call to a member function expects() on null

/var/www/html/tests/Unit/Domains/Auth/Services/JwtTokenServiceTest.php:162

4) Tests\Unit\Domains\Auth\Services\JwtTokenServiceTest::test_validateAccessToken_should_skip_blacklist_check_when_disabled
Error: Call to a member function expects() on null

/var/www/html/tests/Unit/Domains/Auth/Services/JwtTokenServiceTest.php:210

5) Tests\Unit\Domains\Auth\Services\JwtTokenServiceTest::test_validateRefreshToken_should_return_payload_when_valid_token
Error: Call to a member function expects() on null

/var/www/html/tests/Unit/Domains/Auth/Services/JwtTokenServiceTest.php:243

6) Tests\Unit\Domains\Auth\Services\JwtTokenServiceTest::test_validateRefreshToken_should_throw_exception_when_not_found_in_database
Error: Call to a member function expects() on null

/var/www/html/tests/Unit/Domains/Auth/Services/JwtTokenServiceTest.php:289

7) Tests\Unit\Domains\Auth\Services\JwtTokenServiceTest::test_validateRefreshToken_should_throw_exception_when_revoked
Error: Call to a member function expects() on null

/var/www/html/tests/Unit/Domains/Auth/Services/JwtTokenServiceTest.php:325

8) Tests\Unit\Domains\Auth\Services\JwtTokenServiceTest::test_extractPayload_should_return_payload_without_validation
Error: Call to a member function expects() on null

/var/www/html/tests/Unit/Domains/Auth/Services/JwtTokenServiceTest.php:359

9) Tests\Unit\Domains\Auth\Services\JwtTokenServiceTest::test_refreshTokens_should_return_new_token_pair
Error: Call to a member function method() on null

/var/www/html/tests/Unit/Domains/Auth/Services/JwtTokenServiceTest.php:389

10) Tests\Unit\Domains\Auth\Services\JwtTokenServiceTest::test_revokeToken_should_add_token_to_blacklist
Error: Call to a member function expects() on null

/var/www/html/tests/Unit/Domains/Auth/Services/JwtTokenServiceTest.php:431

11) Tests\Unit\Domains\Auth\Services\JwtTokenServiceTest::test_revokeToken_should_delete_refresh_token_from_repository
Error: Call to a member function expects() on null

/var/www/html/tests/Unit/Domains/Auth/Services/JwtTokenServiceTest.php:464

12) Tests\Unit\Domains\Auth\Services\JwtTokenServiceTest::test_revokeToken_should_return_false_when_exception_occurs
Error: Call to a member function expects() on null

/var/www/html/tests/Unit/Domains/Auth/Services/JwtTokenServiceTest.php:490

13) Tests\Unit\Domains\Auth\Services\JwtTokenServiceTest::test_isTokenRevoked_should_return_true_when_blacklisted
Error: Call to a member function expects() on null

/var/www/html/tests/Unit/Domains/Auth/Services/JwtTokenServiceTest.php:543

14) Tests\Unit\Domains\Auth\Services\JwtTokenServiceTest::test_isTokenRevoked_should_return_false_when_not_blacklisted
Error: Call to a member function expects() on null

/var/www/html/tests/Unit/Domains/Auth/Services/JwtTokenServiceTest.php:568

15) Tests\Unit\Domains\Auth\Services\JwtTokenServiceTest::test_isTokenRevoked_should_return_true_when_token_invalid
Error: Call to a member function expects() on null

/var/www/html/tests/Unit/Domains/Auth/Services/JwtTokenServiceTest.php:591

16) Tests\Unit\Domains\Auth\Services\JwtTokenServiceTest::test_getTokenRemainingTime_should_return_remaining_seconds
Error: Call to a member function expects() on null

/var/www/html/tests/Unit/Domains/Auth/Services/JwtTokenServiceTest.php:618

17) Tests\Unit\Domains\Auth\Services\JwtTokenServiceTest::test_getTokenRemainingTime_should_return_zero_when_expired
Error: Call to a member function expects() on null

/var/www/html/tests/Unit/Domains/Auth/Services/JwtTokenServiceTest.php:646

18) Tests\Unit\Domains\Auth\Services\JwtTokenServiceTest::test_getTokenRemainingTime_should_return_zero_when_token_invalid
Error: Call to a member function expects() on null

/var/www/html/tests/Unit/Domains/Auth/Services/JwtTokenServiceTest.php:663

19) Tests\Unit\Domains\Auth\Services\JwtTokenServiceTest::test_isTokenNearExpiry_should_return_true_when_near_expiry
Error: Call to a member function expects() on null

/var/www/html/tests/Unit/Domains/Auth/Services/JwtTokenServiceTest.php:690

20) Tests\Unit\Domains\Auth\Services\JwtTokenServiceTest::test_isTokenNearExpiry_should_return_false_when_not_near_expiry
Error: Call to a member function expects() on null

/var/www/html/tests/Unit/Domains/Auth/Services/JwtTokenServiceTest.php:717

21) Tests\Unit\Domains\Auth\Services\JwtTokenServiceTest::test_isTokenOwnedBy_should_return_true_when_owned_by_user
Error: Call to a member function expects() on null

/var/www/html/tests/Unit/Domains/Auth/Services/JwtTokenServiceTest.php:743

22) Tests\Unit\Domains\Auth\Services\JwtTokenServiceTest::test_isTokenOwnedBy_should_return_false_when_not_owned_by_user
Error: Call to a member function expects() on null

/var/www/html/tests/Unit/Domains/Auth/Services/JwtTokenServiceTest.php:769

23) Tests\Unit\Domains\Auth\Services\JwtTokenServiceTest::test_isTokenFromDevice_should_return_true_when_from_device
Error: Call to a member function expects() on null

/var/www/html/tests/Unit/Domains/Auth/Services/JwtTokenServiceTest.php:795

24) Tests\Unit\Domains\Auth\Services\JwtTokenServiceTest::test_isTokenFromDevice_should_return_false_when_from_different_device
Error: Call to a member function expects() on null

/var/www/html/tests/Unit/Domains/Auth/Services/JwtTokenServiceTest.php:821

25) Tests\Unit\Domains\Auth\Services\JwtTokenServiceTest::test_createJwtPayloadFromArray_should_create_valid_payload
Error: Call to a member function expects() on null

/var/www/html/tests/Unit/Domains/Auth/Services/JwtTokenServiceTest.php:877

26) Tests\Integration\AuthControllerTest::registerUserSuccessfully
TypeError: App\Application\Controllers\Api\V1\AuthController::__construct(): Argument #2 ($authenticationService) must be of type AlleyNote\Domains\Auth\Contracts\AuthenticationServiceInterface, Mockery_2_App_Shared_Contracts_ValidatorInterface given, called in /var/www/html/tests/Integration/AuthControllerTest.php on line 135

/var/www/html/app/Application/Controllers/Api/V1/AuthController.php:35
/var/www/html/tests/Integration/AuthControllerTest.php:135
/var/www/html/vendor/bin/phpunit:122

27) Tests\Integration\AuthControllerTest::returnValidationErrorsForInvalidRegistrationData
TypeError: App\Application\Controllers\Api\V1\AuthController::__construct(): Argument #2 ($authenticationService) must be of type AlleyNote\Domains\Auth\Contracts\AuthenticationServiceInterface, Mockery_2_App_Shared_Contracts_ValidatorInterface given, called in /var/www/html/tests/Integration/AuthControllerTest.php on line 170

/var/www/html/app/Application/Controllers/Api/V1/AuthController.php:35
/var/www/html/tests/Integration/AuthControllerTest.php:170
/var/www/html/vendor/bin/phpunit:122

28) Tests\Integration\AuthControllerTest::loginUserSuccessfully
TypeError: App\Application\Controllers\Api\V1\AuthController::__construct(): Argument #2 ($authenticationService) must be of type AlleyNote\Domains\Auth\Contracts\AuthenticationServiceInterface, Mockery_2_App_Shared_Contracts_ValidatorInterface given, called in /var/www/html/tests/Integration/AuthControllerTest.php on line 202

/var/www/html/app/Application/Controllers/Api/V1/AuthController.php:35
/var/www/html/tests/Integration/AuthControllerTest.php:202
/var/www/html/vendor/bin/phpunit:122

29) Tests\Integration\AuthControllerTest::returnErrorForInvalidLogin
TypeError: App\Application\Controllers\Api\V1\AuthController::__construct(): Argument #2 ($authenticationService) must be of type AlleyNote\Domains\Auth\Contracts\AuthenticationServiceInterface, Mockery_2_App_Shared_Contracts_ValidatorInterface given, called in /var/www/html/tests/Integration/AuthControllerTest.php on line 229

/var/www/html/app/Application/Controllers/Api/V1/AuthController.php:35
/var/www/html/tests/Integration/AuthControllerTest.php:229
/var/www/html/vendor/bin/phpunit:122

30) Tests\Integration\AuthControllerTest::logoutUserSuccessfully
TypeError: App\Application\Controllers\Api\V1\AuthController::__construct(): Argument #2 ($authenticationService) must be of type AlleyNote\Domains\Auth\Contracts\AuthenticationServiceInterface, Mockery_2_App_Shared_Contracts_ValidatorInterface given, called in /var/www/html/tests/Integration/AuthControllerTest.php on line 242

/var/www/html/app/Application/Controllers/Api/V1/AuthController.php:35
/var/www/html/tests/Integration/AuthControllerTest.php:242
/var/www/html/vendor/bin/phpunit:122

31) Tests\Integration\JwtAuthenticationIntegrationTest::canPerformCompleteLoginFlow
AlleyNote\Domains\Auth\Exceptions\AuthenticationException: Login failed: Failed to create refresh token: SQLSTATE[HY000]: General error: 1 table refresh_tokens has no column named token_hash

/var/www/html/app/Domains/Auth/Services/AuthenticationService.php:110
/var/www/html/tests/Integration/JwtAuthenticationIntegrationTest.php:95
/var/www/html/vendor/bin/phpunit:122

32) Tests\Integration\JwtAuthenticationIntegrationTest::canRefreshTokensSuccessfully
AlleyNote\Domains\Auth\Exceptions\AuthenticationException: Login failed: Failed to create refresh token: SQLSTATE[HY000]: General error: 1 table refresh_tokens has no column named token_hash

/var/www/html/app/Domains/Auth/Services/AuthenticationService.php:110
/var/www/html/tests/Integration/JwtAuthenticationIntegrationTest.php:132
/var/www/html/vendor/bin/phpunit:122

33) Tests\Integration\JwtAuthenticationIntegrationTest::canLogoutAndBlacklistTokens
AlleyNote\Domains\Auth\Exceptions\AuthenticationException: Login failed: Failed to create refresh token: SQLSTATE[HY000]: General error: 1 table refresh_tokens has no column named token_hash

/var/www/html/app/Domains/Auth/Services/AuthenticationService.php:110
/var/www/html/tests/Integration/JwtAuthenticationIntegrationTest.php:179
/var/www/html/vendor/bin/phpunit:122

34) Tests\Integration\JwtAuthenticationIntegrationTest::canManageMultipleDeviceLogins
AlleyNote\Domains\Auth\Exceptions\AuthenticationException: Login failed: Failed to create refresh token: SQLSTATE[HY000]: General error: 1 table refresh_tokens has no column named token_hash

/var/www/html/app/Domains/Auth/Services/AuthenticationService.php:110
/var/www/html/tests/Integration/JwtAuthenticationIntegrationTest.php:217
/var/www/html/vendor/bin/phpunit:122

35) Tests\Integration\JwtAuthenticationIntegrationTest::canPerformHealthCheck
AlleyNote\Domains\Auth\Exceptions\AuthenticationException: Login failed: Failed to create refresh token: SQLSTATE[HY000]: General error: 1 table refresh_tokens has no column named token_hash

/var/www/html/app/Domains/Auth/Services/AuthenticationService.php:110
/var/www/html/tests/Integration/JwtAuthenticationIntegrationTest.php:352
/var/www/html/vendor/bin/phpunit:122

36) Tests\Integration\JwtTokenBlacklistIntegrationTest::testBasicBlacklistIntegration
PDOException: SQLSTATE[HY000]: General error: 1 table token_blacklist has no column named metadata

/var/www/html/app/Infrastructure/Auth/Repositories/TokenBlacklistRepository.php:52
/var/www/html/tests/Integration/JwtTokenBlacklistIntegrationTest.php:64
/var/www/html/vendor/bin/phpunit:122

37) Tests\Integration\JwtTokenBlacklistIntegrationTest::testServiceBlacklistOperations
TypeError: AlleyNote\Domains\Auth\Services\TokenBlacklistService::blacklistToken(): Argument #4 ($expiresAt) must be of type DateTime, DateTimeImmutable given, called in /var/www/html/tests/Integration/JwtTokenBlacklistIntegrationTest.php on line 86

/var/www/html/app/Domains/Auth/Services/TokenBlacklistService.php:64
/var/www/html/tests/Integration/JwtTokenBlacklistIntegrationTest.php:86
/var/www/html/vendor/bin/phpunit:122

38) Tests\Integration\JwtTokenBlacklistIntegrationTest::testBatchOperationsIntegration
TypeError: AlleyNote\Domains\Auth\ValueObjects\TokenBlacklistEntry::__construct(): Argument #3 ($expiresAt) must be of type DateTimeImmutable, DateTime given, called in /var/www/html/tests/Integration/JwtTokenBlacklistIntegrationTest.php on line 119

/var/www/html/app/Domains/Auth/ValueObjects/TokenBlacklistEntry.php:67
/var/www/html/tests/Integration/JwtTokenBlacklistIntegrationTest.php:119
/var/www/html/vendor/bin/phpunit:122

39) Tests\Integration\JwtTokenBlacklistIntegrationTest::testStatisticsIntegration
TypeError: AlleyNote\Domains\Auth\ValueObjects\TokenBlacklistEntry::__construct(): Argument #3 ($expiresAt) must be of type DateTimeImmutable, DateTime given, called in /var/www/html/tests/Integration/JwtTokenBlacklistIntegrationTest.php on line 173

/var/www/html/app/Domains/Auth/ValueObjects/TokenBlacklistEntry.php:67
/var/www/html/tests/Integration/JwtTokenBlacklistIntegrationTest.php:173
/var/www/html/vendor/bin/phpunit:122

40) Tests\Integration\JwtTokenBlacklistIntegrationTest::testAutoCleanupIntegration
TypeError: AlleyNote\Domains\Auth\ValueObjects\TokenBlacklistEntry::__construct(): Argument #3 ($expiresAt) must be of type DateTimeImmutable, DateTime given, called in /var/www/html/tests/Integration/JwtTokenBlacklistIntegrationTest.php on line 211

/var/www/html/app/Domains/Auth/ValueObjects/TokenBlacklistEntry.php:67
/var/www/html/tests/Integration/JwtTokenBlacklistIntegrationTest.php:211
/var/www/html/vendor/bin/phpunit:122

41) Tests\Integration\JwtTokenBlacklistIntegrationTest::testQueryFunctionsIntegration
TypeError: AlleyNote\Domains\Auth\ValueObjects\TokenBlacklistEntry::__construct(): Argument #3 ($expiresAt) must be of type DateTimeImmutable, DateTime given, called in /var/www/html/tests/Integration/JwtTokenBlacklistIntegrationTest.php on line 256

/var/www/html/app/Domains/Auth/ValueObjects/TokenBlacklistEntry.php:67
/var/www/html/tests/Integration/JwtTokenBlacklistIntegrationTest.php:256
/var/www/html/vendor/bin/phpunit:122

42) Tests\Integration\JwtTokenBlacklistIntegrationTest::testErrorHandlingIntegration
TypeError: AlleyNote\Domains\Auth\ValueObjects\TokenBlacklistEntry::__construct(): Argument #3 ($expiresAt) must be of type DateTimeImmutable, DateTime given, called in /var/www/html/tests/Integration/JwtTokenBlacklistIntegrationTest.php on line 309

/var/www/html/app/Domains/Auth/ValueObjects/TokenBlacklistEntry.php:67
/var/www/html/tests/Integration/JwtTokenBlacklistIntegrationTest.php:309
/var/www/html/vendor/bin/phpunit:122

43) Tests\Security\PasswordHashingTest::shouldHashPasswordUsingArgon2id
TypeError: PHPUnit\Framework\Assert::assertStringStartsWith(): Argument #2 ($string) must be of type string, false given, called in /var/www/html/tests/Security/PasswordHashingTest.php on line 121

/var/www/html/tests/Security/PasswordHashingTest.php:121
/var/www/html/vendor/bin/phpunit:122

44) Tests\Security\PasswordHashingTest::shouldUseAppropriateHashingOptions
TypeError: password_get_info(): Argument #1 ($hash) must be of type string, false given

/var/www/html/tests/Security/PasswordHashingTest.php:151
/var/www/html/vendor/bin/phpunit:122

--

There were 8 failures:

1) Tests\Unit\Domains\Auth\Contracts\JwtTokenServiceInterfaceTest::testInterfaceHasCorrectDocumentation
Failed asserting that '/**\n
 * JWT Token 服務介面.\n
 *\n
 * 定義JWT token的核心操作方法，包含token產生、驗證、解析等功能。\n
 * 採用RS256演算法進行token簽名，確保token的安全性和可驗證性。\n
 */' [UTF-8](length: 212) contains "@package AlleyNote\Domains\Auth\Contracts" [ASCII](length: 41).

/var/www/html/tests/Unit/Domains/Auth/Contracts/JwtTokenServiceInterfaceTest.php:332

2) Tests\Unit\Domains\Auth\Contracts\RefreshTokenRepositoryInterfaceTest::testInterfaceHasCorrectDocumentation
Failed asserting that '/**\n
 * Refresh Token Repository 介面.\n
 *\n
 * 定義refresh token的資料存取操作，包含建立、查詢、更新、刪除等功能。\n
 * 負責管理refresh token的持久化儲存和生命週期管理。\n
 */' [UTF-8](length: 215) contains "@package AlleyNote\Domains\Auth\Contracts" [ASCII](length: 41).

/var/www/html/tests/Unit/Domains/Auth/Contracts/RefreshTokenRepositoryInterfaceTest.php:418

3) Tests\Unit\Domains\Auth\Contracts\TokenBlacklistRepositoryInterfaceTest::testInterfaceHasCorrectDocumentation
Failed asserting that '/**\n
 * Token 黑名單 Repository 介面.\n
 *\n
 * 定義token黑名單的資料存取操作，包含新增、查詢、刪除等功能。\n
 * 負責管理被撤銷或無效token的黑名單記錄，確保token安全性。\n
 */' [UTF-8](length: 221) contains "@package AlleyNote\Domains\Auth\Contracts" [ASCII](length: 41).

/var/www/html/tests/Unit/Domains/Auth/Contracts/TokenBlacklistRepositoryInterfaceTest.php:485

4) Tests\Unit\Domains\Auth\Services\JwtTokenServiceTest::test_validateAccessToken_should_throw_exception_when_token_blacklisted
Expectation failed for method name is "isBlacklisted" when invoked 1 time.
Method was expected to be called 1 time, actually called 0 times.

5) Tests\Unit\Domains\Auth\Services\JwtTokenServiceTest::test_revokeAllUserTokens_should_delete_all_user_refresh_tokens
Failed asserting that 0 is identical to 3.

/var/www/html/tests/Unit/Domains/Auth/Services/JwtTokenServiceTest.php:532

6) Tests\Unit\Services\AuthServiceTest::it_should_register_new_user_successfully
Failed asserting that null matches expected 'testuser'.

/var/www/html/tests/Unit/Services/AuthServiceTest.php:98

7) Tests\Integration\JwtAuthenticationIntegrationTest::canCleanupExpiredBlacklistEntries
Failed asserting that 0 matches expected 1.

/var/www/html/tests/Integration/JwtAuthenticationIntegrationTest.php:328
/var/www/html/vendor/bin/phpunit:122

8) Tests\Security\PasswordHashingTest::shouldPreventPasswordReuse
Failed asserting that exception of type "TypeError" matches expected exception "InvalidArgumentException". Message was: "App\Domains\Auth\Repositories\UserRepository::updatePassword(): Argument #1 ($id) must be of type int, null given, called in /var/www/html/tests/Security/PasswordHashingTest.php on line 210" at
/var/www/html/app/Domains/Auth/Repositories/UserRepository.php:127
/var/www/html/tests/Security/PasswordHashingTest.php:210
/var/www/html/vendor/bin/phpunit:122
.

/var/www/html/vendor/bin/phpunit:122

ERRORS!
Tests: 1162, Assertions: 5225, Errors: 44, Failures: 8, Warnings: 29, PHPUnit Deprecations: 194, Skipped: 14.
