const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/home-CfX1s-zX.js","assets/posts-D8uqMnbu.js","assets/vendor-core-DW9qjkZC.js","assets/login-C44FqaBG.js","assets/toast-ChPGQGGG.js","assets/formValidator-BZ20TrvF.js","assets/vendor-ckeditor-HyW9E3ya.js","assets/Loading-D3hznI52.js","assets/forgotPassword-z1vMQC0F.js","assets/post-DXIU0dxN.js","assets/dashboard-CYw-tU_3.js","assets/DashboardLayout-BjmJ-OJc.js","assets/posts-B_FRwrEJ.js","assets/ConfirmationDialog-DKaQBUc8.js","assets/postEditor-DyRcbj-G.js","assets/profile-1wh3CXyn.js","assets/users-nxFUwfS-.js","assets/users-CWrqSBxp.js","assets/Modal-oATPHkxR.js","assets/roles-B7iRuaIK.js","assets/statistics-B03-dTBG.js","assets/vendor-chart-CJITHfyz.js","assets/tags-BkxEYtL8.js","assets/settings-Cq_di6Hd.js","assets/notFound-w_6r5Sfi.js"])))=>i.map(i=>d[i]);
import{N as e,a as t}from"./vendor-core-DW9qjkZC.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const s={},r=function(e,t,r){let n=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),r=(null==e?void 0:e.nonce)||(null==e?void 0:e.getAttribute("nonce"));n=Promise.allSettled(t.map(e=>{if((e=function(e){return"/"+e}(e))in s)return;s[e]=!0;const t=e.endsWith(".css"),n=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${n}`))return;const i=document.createElement("link");return i.rel=t?"stylesheet":"modulepreload",t||(i.as="script"),i.crossOrigin="",i.href=e,r&&i.setAttribute("nonce",r),document.head.appendChild(i),t?new Promise((t,s)=>{i.addEventListener("load",t),i.addEventListener("error",()=>s(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function i(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return n.then(t=>{for(const e of t||[])"rejected"===e.status&&i(e.reason);return e().catch(i)})};const n={baseURL:"/api",timeout:parseInt(void 0)||3e4,headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"},withCredentials:!0,jwt:{storageKey:"alleynote_token",refreshThreshold:parseInt(void 0)||300},csrf:{headerName:"X-CSRF-TOKEN",cookieName:"csrf_token"},features:{enableMock:!1,enableLogger:!1}},i={AUTH:{LOGIN:"/auth/login",LOGOUT:"/auth/logout",REFRESH:"/auth/refresh",ME:"/auth/me"},POSTS:{LIST:"/posts",DETAIL:e=>`/posts/${e}`,CREATE:"/posts",UPDATE:e=>`/posts/${e}`,DELETE:e=>`/posts/${e}`,PUBLISH:e=>`/posts/${e}/publish`,DRAFT:e=>`/posts/${e}/draft`},ATTACHMENTS:{UPLOAD:"/attachments/upload",DELETE:e=>`/attachments/${e}`},USERS:{LIST:"/users",DETAIL:e=>`/users/${e}`,CREATE:"/users",UPDATE:e=>`/users/${e}`,DELETE:e=>`/users/${e}`},STATISTICS:{OVERVIEW:"/statistics/overview",POSTS:"/statistics/posts",VIEWS:"/statistics/views"}};const o=new class{constructor(){this.storageKey=n.jwt.storageKey,this.refreshThreshold=n.jwt.refreshThreshold,this.refreshPromise=null}setToken(e,t=3600){const s={token:e,expiresAt:Date.now()+1e3*t};sessionStorage.setItem(this.storageKey,JSON.stringify(s))}getToken(){const e=this._getTokenData();return e?e.token:null}removeToken(){sessionStorage.removeItem(this.storageKey),this.refreshPromise=null}isValid(){const e=this._getTokenData();return!!e&&Date.now()<e.expiresAt}shouldRefresh(){const e=this._getTokenData();if(!e)return!1;const t=(e.expiresAt-Date.now())/1e3;return t>0&&t<this.refreshThreshold}async refreshToken(){return this.refreshPromise||(this.refreshPromise=this._doRefreshToken().then(e=>(this.refreshPromise=null,e)).catch(e=>{throw this.refreshPromise=null,e})),this.refreshPromise}async _doRefreshToken(){var e;try{const t=this.getToken();if(!t)throw new Error("No token to refresh");const s=await fetch(`${n.baseURL}/auth/refresh`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}});if(!s.ok)throw new Error("Token refresh failed");const r=await s.json();if(r.success&&(null==(e=r.data)?void 0:e.token))return this.setToken(r.data.token,r.data.expires_in),r.data.token;throw new Error("Invalid refresh response")}catch(t){throw this.removeToken(),t}}_getTokenData(){try{const e=sessionStorage.getItem(this.storageKey);return e?JSON.parse(e):null}catch(e){return null}}},a=new class{constructor(e={}){this.state={...e},this.listeners=new Map}get(e){return this.state[e]}set(e,t){const s=this.state[e];this.state[e]=t,this.notify(e,t,s)}update(e,t){const s=t(this.state[e]);this.set(e,s)}subscribe(e,t){return this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t),()=>{this.listeners.get(e).delete(t)}}notify(e,t,s){const r=this.listeners.get(e);r&&r.forEach(e=>{e(t,s)})}reset(){this.state={}}getAll(){return{...this.state}}}({user:null,isAuthenticated:!1,theme:"light",sidebarCollapsed:!1,notifications:[]}),l={setUser(e){a.set("user",e),a.set("isAuthenticated",!!e),e?localStorage.setItem("alleynote_user",JSON.stringify(e)):localStorage.removeItem("alleynote_user")},clearUser(){a.set("user",null),a.set("isAuthenticated",!1),localStorage.removeItem("alleynote_user")},restoreUser(){try{const e=localStorage.getItem("alleynote_user");if(e&&o.isValid()){const t=JSON.parse(e);return a.set("user",t),a.set("isAuthenticated",!0),t}}catch(e){}return null},toggleSidebar(){const e=a.get("sidebarCollapsed");a.set("sidebarCollapsed",!e)},addNotification(e){a.update("notifications",t=>[...t,{id:Date.now(),timestamp:(new Date).toISOString(),...e}])}},c={getCurrentUser:()=>a.get("user"),isAuthenticated:()=>!!a.get("isAuthenticated")||!!o.isValid()&&(l.restoreUser(),a.get("isAuthenticated")),getUserRole(){const e=a.get("user");if(null==e?void 0:e.role)return e.role;if((null==e?void 0:e.roles)&&Array.isArray(e.roles)&&e.roles.length>0){const t=e.roles;for(const e of t)if("object"==typeof e&&e.id&&1===e.id)return"super_admin";return"object"==typeof t[0]?t[0].name:t[0]}return null},isAdmin(){const e=a.get("user"),t=this.getUserRole();if("admin"===t||"super_admin"===t||"超級管理員"===t)return!0;if((null==e?void 0:e.roles)&&Array.isArray(e.roles))for(const s of e.roles)if("object"==typeof s){if(1===s.id)return!0;if("超級管理員"===s.name||"admin"===s.name||"super_admin"===s.name)return!0}return!1}};l.restoreUser();const d=new e("/",{hash:!1});function h(){return!!c.isAuthenticated()||(d.navigate("/login"),!1)}const u=new class{constructor(){this.cookieName=n.csrf.cookieName}getToken(){const e=document.cookie.split(";");for(const t of e){const[e,s]=t.trim().split("=");if(e===this.cookieName)return decodeURIComponent(s)}return null}hasToken(){return null!==this.getToken()}};class m extends Error{constructor(e,t,s,r=null){super(t),this.name="APIError",this.code=e,this.status=s,this.details=r}isValidationError(){return"VALIDATION_ERROR"===this.code&&null!==this.details}isNetworkError(){return"NETWORK_ERROR"===this.code}isAuthError(){return"UNAUTHORIZED"===this.code}getUserMessage(){return this.message}getValidationErrors(){return this.details||{}}}const g=t.create({baseURL:n.baseURL,timeout:n.timeout,headers:n.headers,withCredentials:n.withCredentials});g.interceptors.request.use(async function(e){var t;if(o.shouldRefresh())try{await o.refreshToken()}catch(r){}const s=o.getToken();if(s&&(e.headers.Authorization=`Bearer ${s}`),["post","put","patch","delete"].includes(null==(t=e.method)?void 0:t.toLowerCase())){const t=u.getToken();t&&(e.headers[n.csrf.headerName]=t)}return e},function(e){return Promise.reject(e)}),g.interceptors.response.use(function(e){return o.shouldRefresh(),e.data},function(e){if(!e.response)return Promise.reject(new m("NETWORK_ERROR","網路連線失敗，請檢查您的網路連線",0));const{status:t,data:s}=e.response;if(401===t)return o.removeToken(),window.location.pathname.includes("/login")||(window.location.href="/login"),Promise.reject(new m("UNAUTHORIZED","登入已過期，請重新登入",t));if(403===t)return Promise.reject(new m("FORBIDDEN","您沒有權限執行此操作",t));if(404===t)return Promise.reject(new m("NOT_FOUND","請求的資源不存在",t));if(422===t){const e=s.errors||{};return Promise.reject(new m("VALIDATION_ERROR","資料驗證失敗",t,e))}if(429===t)return Promise.reject(new m("RATE_LIMIT","請求過於頻繁，請稍後再試",t));if(t>=500){let e="伺服器錯誤，請稍後再試";return s&&(s.error?e=s.error:s.message&&(e=s.message)),Promise.reject(new m("SERVER_ERROR",e,t))}let r="發生未知錯誤";return s&&(s.error?r=s.error:s.message&&(r=s.message)),Promise.reject(new m("UNKNOWN_ERROR",r,t))});const p={async login(e){const t=await g.post(i.AUTH.LOGIN,e);if(t&&t.data){const e=t.data;if(e.access_token){o.setToken(e.access_token,e.expires_in||3600),e.refresh_token&&localStorage.setItem("alleynote_refresh_token",e.refresh_token);const t=JSON.parse(localStorage.getItem("alleynote_user")||"{}");t.access_token=e.access_token,localStorage.setItem("alleynote_user",JSON.stringify(t))}else if(e.token){o.setToken(e.token,e.expires_in||3600);const t=JSON.parse(localStorage.getItem("alleynote_user")||"{}");t.access_token=e.token,localStorage.setItem("alleynote_user",JSON.stringify(t))}return e}if(t&&t.access_token){o.setToken(t.access_token,t.expires_in||3600);const e=JSON.parse(localStorage.getItem("alleynote_user")||"{}");return e.access_token=t.access_token,localStorage.setItem("alleynote_user",JSON.stringify(e)),t}return t},async logout(){try{await g.post(i.AUTH.LOGOUT)}finally{o.removeToken()}},me:async()=>(await g.get(i.AUTH.ME)).data,isAuthenticated:()=>o.isValid()};const f=new class{constructor(){this.isOnline=navigator.onLine,this.banner=null,this.retryTimer=null,this.retryCount=0,this.maxRetries=3}init(){window.addEventListener("online",()=>this.handleOnline()),window.addEventListener("offline",()=>this.handleOffline()),navigator.onLine||this.handleOffline()}handleOnline(){this.isOnline=!0,this.retryCount=0,this.hideBanner(),this.showToast("網路連線已恢復","success"),this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)}handleOffline(){this.isOnline=!1,this.showBanner(),this.startRetrying()}showBanner(){this.hideBanner(),this.banner=document.createElement("div"),this.banner.id="offline-banner",this.banner.className="fixed top-0 left-0 right-0 z-[10000] bg-red-600 text-white py-3 px-4 shadow-lg animate-slide-down",this.banner.innerHTML='\n            <div class="container mx-auto flex items-center justify-between">\n                <div class="flex items-center gap-3">\n                    <i class="fas fa-wifi-slash text-xl animate-pulse"></i>\n                    <div>\n                        <p class="font-semibold">無法連線到網路</p>\n                        <p class="text-sm opacity-90">請檢查您的網路連線</p>\n                    </div>\n                </div>\n                <div class="flex items-center gap-3">\n                    <span class="text-sm" id="retry-status"></span>\n                    <button\n                        id="retry-connection-btn"\n                        class="px-4 py-2 bg-white text-red-600 rounded-lg hover:bg-red-50 transition-colors font-medium"\n                    >\n                        <i class="fas fa-sync-alt mr-2"></i>\n                        重試\n                    </button>\n                    <button\n                        id="close-offline-banner"\n                        class="p-2 hover:bg-red-700 rounded-lg transition-colors"\n                    >\n                        <i class="fas fa-times"></i>\n                    </button>\n                </div>\n            </div>\n        ',document.body.appendChild(this.banner);const e=document.getElementById("retry-connection-btn"),t=document.getElementById("close-offline-banner");null==e||e.addEventListener("click",()=>this.checkConnection()),null==t||t.addEventListener("click",()=>this.hideBanner())}hideBanner(){this.banner&&(this.banner.remove(),this.banner=null)}startRetrying(){this.retryCount=0,this.scheduleRetry()}scheduleRetry(){if(this.retryCount>=this.maxRetries)return void this.updateRetryStatus("已停止自動重試");const e=Math.min(5e3*Math.pow(2,this.retryCount),3e4);this.updateRetryStatus(e/1e3+" 秒後自動重試..."),this.retryTimer=setTimeout(()=>{this.checkConnection()},e)}async checkConnection(){this.updateRetryStatus("正在檢查連線...");try{(await fetch("/api/health",{method:"HEAD",cache:"no-cache"})).ok?this.handleOnline():this.handleRetryFailure()}catch(e){this.handleRetryFailure()}}handleRetryFailure(){this.retryCount++,this.updateRetryStatus("連線失敗"),this.retryCount<this.maxRetries?setTimeout(()=>this.scheduleRetry(),1e3):this.updateRetryStatus("已達最大重試次數")}updateRetryStatus(e){const t=document.getElementById("retry-status");t&&(t.textContent=e)}showToast(e,t="info"){if(window.toast)return void window.toast[t](e);const s=document.createElement("div");s.className="fixed top-20 right-4 z-[10001] px-6 py-3 rounded-lg shadow-lg text-white animate-fade-in "+("success"===t?"bg-green-600":"bg-blue-600"),s.textContent=e,document.body.appendChild(s),setTimeout(()=>{s.remove()},3e3)}getStatus(){return{isOnline:this.isOnline,retryCount:this.retryCount}}destroy(){window.removeEventListener("online",this.handleOnline),window.removeEventListener("offline",this.handleOffline),this.hideBanner(),this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)}};"undefined"!=typeof window&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{f.init()}):f.init());class v{constructor(){this.registration=null,this.updateAvailable=!1,this.listeners=new Map}async register(e="/sw.js",t={}){if(!("serviceWorker"in navigator))return null;try{return this.registration=await navigator.serviceWorker.register(e,{scope:"/",...t}),this.registration.addEventListener("updatefound",()=>{this.handleUpdateFound()}),this.registration.waiting&&(this.updateAvailable=!0,this.emit("updateAvailable",this.registration.waiting)),this.registration.installing&&this.trackInstalling(this.registration.installing),this.checkForUpdates(),this.registration}catch(s){throw s}}handleUpdateFound(){const e=this.registration.installing;this.trackInstalling(e)}trackInstalling(e){e.addEventListener("statechange",()=>{"installed"===e.state&&(navigator.serviceWorker.controller?(this.updateAvailable=!0,this.emit("updateAvailable",e)):this.emit("installed",e)),"activated"===e.state&&this.emit("activated",e)})}async checkForUpdates(){if(this.registration)try{await this.registration.update()}catch(e){}}async skipWaiting(){if(this.registration&&this.registration.waiting)return this.registration.waiting.postMessage({type:"SKIP_WAITING"}),new Promise(e=>{navigator.serviceWorker.addEventListener("controllerchange",()=>{this.emit("controllerchange"),e()},{once:!0})})}async updateAndReload(){await this.skipWaiting(),window.location.reload()}async unregister(){if(!this.registration)return!1;try{const e=await this.registration.unregister();return this.registration=null,e}catch(e){return!1}}async postMessage(e){if(!this.registration||!this.registration.active)throw new Error("Service Worker not active");return new Promise((t,s)=>{const r=new MessageChannel;r.port1.onmessage=e=>{e.data.error?s(e.data.error):t(e.data)},this.registration.active.postMessage(e,[r.port2])})}async clearCache(e){await this.postMessage({type:"CLEAR_CACHE",payload:{cacheName:e}})}async cacheUrls(e){await this.postMessage({type:"CACHE_URLS",payload:{urls:e}})}on(e,t){return this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t),()=>this.off(e,t)}off(e,t){this.listeners.has(e)&&this.listeners.get(e).delete(t)}emit(e,t){this.listeners.has(e)&&this.listeners.get(e).forEach(e=>{try{e(t)}catch(s){}})}getStatus(){return{supported:"serviceWorker"in navigator,registered:!!this.registration,active:!(!this.registration||!this.registration.active),waiting:!(!this.registration||!this.registration.waiting),installing:!(!this.registration||!this.registration.installing),updateAvailable:this.updateAvailable}}}let y=null;function w(){return y||(y=new v),y}class E{constructor(e={}){this.options={root:null,rootMargin:"50px",threshold:.01,loadingClass:"lazy-loading",loadedClass:"lazy-loaded",errorClass:"lazy-error",placeholder:'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 300"%3E%3Crect fill="%23f3f4f6" width="400" height="300"/%3E%3C/svg%3E',...e},this.observer=null,this.images=new Set,this.init()}init(){"IntersectionObserver"in window?this.observer=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&this.loadImage(e.target)})},{root:this.options.root,rootMargin:this.options.rootMargin,threshold:this.options.threshold}):this.loadAllImages()}observe(e){let t=[];"string"==typeof e?t=Array.from(document.querySelectorAll(e)):e instanceof HTMLImageElement?t=[e]:(e instanceof NodeList||Array.isArray(e))&&(t=Array.from(e)),t.forEach(e=>{this.images.has(e)||(!e.dataset.src&&e.src&&(e.dataset.src=e.src),e.dataset.src&&e.src!==this.options.placeholder&&(e.src=this.options.placeholder),this.images.add(e),this.observer&&this.observer.observe(e))})}unobserve(e){this.observer&&this.images.has(e)&&(this.observer.unobserve(e),this.images.delete(e))}loadImage(e){const t=e.dataset.src||e.src;if(!t||t===this.options.placeholder)return void this.unobserve(e);e.classList.add(this.options.loadingClass);const s=new Image;s.onload=()=>{e.src=t,e.dataset.srcset&&(e.srcset=e.dataset.srcset),e.classList.remove(this.options.loadingClass),e.classList.add(this.options.loadedClass),e.dispatchEvent(new CustomEvent("lazyloaded",{detail:{src:t}})),this.unobserve(e)},s.onerror=()=>{e.classList.remove(this.options.loadingClass),e.classList.add(this.options.errorClass),e.dispatchEvent(new CustomEvent("lazyerror",{detail:{src:t}})),this.unobserve(e)},s.src=t}loadAllImages(){this.images.forEach(e=>{this.loadImage(e)})}load(e){let t=[];"string"==typeof e?t=Array.from(document.querySelectorAll(e)):e instanceof HTMLImageElement&&(t=[e]),t.forEach(e=>{this.images.has(e)&&this.loadImage(e)})}update(){this.images.forEach(e=>{this.observer&&this.observer.unobserve(e)}),this.images.clear(),this.observe("img[data-src]")}destroy(){this.observer&&(this.observer.disconnect(),this.observer=null),this.images.clear()}}let b=null;class _{constructor(){this.enabled=!1,this.environment="production",this.release="1.0.0",this.sentryDSN=void 0,this.sampleRate=parseFloat("1.0"),this.breadcrumbs=[],this.maxBreadcrumbs=50,this.user=null}async init(e={}){if(("production"===this.environment||e.forceEnable)&&this.sentryDSN)try{const t=await r(()=>import("./index-5LAK4lbz.js"),[]);t.init({dsn:this.sentryDSN,environment:this.environment,release:this.release,tracesSampleRate:this.sampleRate,integrations:[new t.BrowserTracing,new t.Replay({maskAllText:!0,blockAllMedia:!0})],replaysSessionSampleRate:.1,replaysOnErrorSampleRate:1,ignoreErrors:["top.GLOBALS","chrome-extension://","moz-extension://","NetworkError","Network request failed","AbortError","The user aborted a request"],denyUrls:[/extensions\//i,/^chrome:\/\//i,/^moz-extension:\/\//i],beforeSend:(e,t)=>(e.request&&(delete e.request.cookies,e.request.headers&&(delete e.request.headers.Authorization,delete e.request.headers.Cookie)),e),...e}),this.Sentry=t,this.enabled=!0,this.setupGlobalErrorHandlers()}catch(t){}}setupGlobalErrorHandlers(){window.addEventListener("unhandledrejection",e=>{this.captureException(e.reason,{type:"unhandledRejection",promise:e.promise})}),window.addEventListener("error",e=>{this.captureException(e.error,{type:"globalError",message:e.message,filename:e.filename,lineno:e.lineno,colno:e.colno})})}captureException(e,t={}){this.enabled&&this.Sentry&&this.Sentry.captureException(e,{contexts:{custom:t}})}captureMessage(e,t="info",s={}){this.enabled&&this.Sentry&&this.Sentry.captureMessage(e,{level:t,contexts:{custom:s}})}addBreadcrumb(e){if(!this.enabled||!this.Sentry)return this.breadcrumbs.push({timestamp:Date.now(),...e}),void(this.breadcrumbs.length>this.maxBreadcrumbs&&this.breadcrumbs.shift());this.Sentry.addBreadcrumb(e)}setUser(e){this.user=e,this.enabled&&this.Sentry&&this.Sentry.setUser({id:e.id,email:e.email,username:e.name,role:e.role})}clearUser(){this.user=null,this.enabled&&this.Sentry&&this.Sentry.setUser(null)}setTags(e){this.enabled&&this.Sentry&&this.Sentry.setTags(e)}setContext(e,t){this.enabled&&this.Sentry&&this.Sentry.setContext(e,t)}startTransaction(e){return this.enabled&&this.Sentry?this.Sentry.startTransaction(e):{startChild:()=>({finish:()=>{}}),finish:()=>{}}}async trackAPIRequest(e,t,s){const r=this.startTransaction({name:`${e} ${t}`,op:"http.client"});try{const e=await s();return r.setStatus("ok"),e}catch(n){throw r.setStatus("internal_error"),this.captureException(n,{type:"apiRequest",method:e,url:t}),n}finally{r.finish()}}trackPageLoad(e){if(this.addBreadcrumb({category:"navigation",message:`Navigated to ${e}`,level:"info"}),window.performance&&window.performance.timing){const t=window.performance.timing,s=t.loadEventEnd-t.navigationStart,r=t.domContentLoadedEventEnd-t.navigationStart;this.setContext("performance",{pageLoadTime:s,domReadyTime:r,route:e})}}trackInteraction(e,t={}){this.addBreadcrumb({category:"user",message:e,level:"info",data:t})}}let k=null;function T(){return k||(k=new _),k}async function S(e={}){const t=T();return await t.init(e),t}const I=(e,t,s)=>{T().captureMessage(e,t,s)},A=Object.freeze(Object.defineProperty({__proto__:null,captureException:(e,t)=>{T().captureException(e,t)},captureMessage:I,getErrorTracker:T,initErrorTracking:S},Symbol.toStringTag,{value:"Module"}));class R{constructor(){this.enabled=!1,this.initialized=!1,this.trackingId=void 0,this.debug=!1,this.queue=[]}init(e={}){if(this.trackingId&&(!this.debug||e.forceEnable))try{this.loadGtagScript(),window.dataLayer=window.dataLayer||[],window.gtag=function(){window.dataLayer.push(arguments)},gtag("js",new Date),gtag("config",this.trackingId,{send_page_view:!1,anonymize_ip:!0,cookie_flags:"SameSite=None;Secure",...e.config}),this.enabled=!0,this.initialized=!0,this.processQueue()}catch(t){}}loadGtagScript(){if(document.querySelector('script[src*="googletagmanager"]'))return;const e=document.createElement("script");e.async=!0,e.src=`https://www.googletagmanager.com/gtag/js?id=${this.trackingId}`,document.head.appendChild(e)}processQueue(){for(;this.queue.length>0;){const{method:e,args:t}=this.queue.shift();this[e](...t)}}enqueue(e,t){this.queue.push({method:e,args:t})}trackPageView(e={}){if(!this.initialized)return void this.enqueue("trackPageView",[e]);if(!this.enabled)return void this.logDebug("Page view",e);const{path:t,title:s,...r}=e;gtag("event","page_view",{page_path:t||window.location.pathname,page_title:s||document.title,page_location:window.location.href,...r})}trackEvent(e,t={}){this.initialized?this.enabled?gtag("event",e,t):this.logDebug("Event",{action:e,...t}):this.enqueue("trackEvent",[e,t])}trackInteraction(e,t,s,r){this.trackEvent(t,{event_category:e,event_label:s,value:r})}trackClick(e,t={}){this.trackEvent("click",{element_name:e,...t})}trackSearch(e,t={}){this.trackEvent("search",{search_term:e,...t})}trackLogin(e="email"){this.trackEvent("login",{method:e})}trackLogout(){this.trackEvent("logout")}trackSignUp(e="email"){this.trackEvent("sign_up",{method:e})}trackFormSubmit(e,t={}){this.trackEvent("form_submit",{form_name:e,...t})}trackDownload(e,t){this.trackEvent("file_download",{file_name:e,file_type:t})}trackVideoPlay(e,t){this.trackEvent("video_start",{video_title:e,video_url:t})}trackError(e,t=!1){this.trackEvent("exception",{description:e,fatal:t})}trackTiming(e,t,s,r){this.trackEvent("timing_complete",{name:t,value:s,event_category:e,event_label:r})}setUserId(e){this.enabled&&gtag("config",this.trackingId,{user_id:e})}setUserProperties(e){this.enabled&&gtag("set","user_properties",e)}setCustomDimensions(e){this.enabled&&Object.entries(e).forEach(([e,t])=>{gtag("set",e,t)})}setEnabled(e){this.enabled=e,this.initialized&&(window[`ga-disable-${this.trackingId}`]=!e)}logDebug(e,t){this.debug}async getClientId(){return this.enabled?new Promise(e=>{gtag("get",this.trackingId,"client_id",e)}):null}}let L=null;function P(){return L||(L=new R),L}function O(e={}){const t=P();return t.init(e),t}const C=Object.freeze(Object.defineProperty({__proto__:null,getAnalytics:P,initAnalytics:O,trackEvent:(e,t)=>{P().trackEvent(e,t)}},Symbol.toStringTag,{value:"Module"}));class x{constructor(){this.enabled=!0,this.metrics={CLS:null,FID:null,FCP:null,LCP:null,TTFB:null,INP:null},this.thresholds={CLS:{good:.1,needsImprovement:.25},FID:{good:100,needsImprovement:300},FCP:{good:1800,needsImprovement:3e3},LCP:{good:2500,needsImprovement:4e3},TTFB:{good:800,needsImprovement:1800},INP:{good:200,needsImprovement:500}}}async init(){if(this.enabled)try{const e=await r(()=>import("./web-vitals-lM_PV5rx.js"),[]);e.onCLS(this.handleMetric.bind(this,"CLS")),e.onFID(this.handleMetric.bind(this,"FID")),e.onFCP(this.handleMetric.bind(this,"FCP")),e.onLCP(this.handleMetric.bind(this,"LCP")),e.onTTFB(this.handleMetric.bind(this,"TTFB")),e.onINP(this.handleMetric.bind(this,"INP"))}catch(e){}}handleMetric(e,t){this.metrics[e]={value:t.value,rating:t.rating,delta:t.delta,id:t.id,entries:t.entries};const s=this.assessMetric(e,t.value);this.reportToAnalytics(e,t,s),"poor"===s&&this.reportPoorMetric(e,t)}assessMetric(e,t){const s=this.thresholds[e];return t<=s.good?"good":t<=s.needsImprovement?"needs-improvement":"poor"}reportToAnalytics(e,t,s){const r=P();r.enabled&&(r.trackEvent("web_vitals",{event_category:"Web Vitals",event_label:e,value:Math.round(t.value),metric_id:t.id,metric_rating:s,metric_delta:Math.round(t.delta)}),r.trackTiming("Web Vitals",e,Math.round(t.value),s))}reportPoorMetric(e,t){const s=`Poor Web Vital: ${e} = ${t.value}`;I(s,"warning",{metric:e,value:t.value,rating:t.rating,threshold:this.thresholds[e],url:window.location.href})}getMetrics(){return{...this.metrics}}getSummary(){const e={};return Object.entries(this.metrics).forEach(([t,s])=>{s&&(e[t]={value:s.value,rating:this.assessMetric(t,s.value),threshold:this.thresholds[t]})}),e}isHealthy(){return Object.entries(this.metrics).every(([e,t])=>!t||"poor"!==this.assessMetric(e,t.value))}getProblematicMetrics(){const e=[];return Object.entries(this.metrics).forEach(([t,s])=>{if(!s)return;const r=this.assessMetric(t,s.value);"good"!==r&&e.push({name:t,value:s.value,rating:r,threshold:this.thresholds[t]})}),e}createReport(){const e=this.getSummary();let t='<div class="web-vitals-report">';return t+="<h3>Web Vitals 效能報告</h3>",t+="<table>",t+="<tr><th>指標</th><th>數值</th><th>評級</th><th>門檻</th></tr>",Object.entries(e).forEach(([e,s])=>{const r="good"===s.rating?"good":"needs-improvement"===s.rating?"warning":"poor";t+=`<tr class="${r}">`,t+=`<td>${e}</td>`,t+=`<td>${s.value.toFixed(2)}</td>`,t+=`<td>${s.rating}</td>`,t+=`<td>Good: ${s.threshold.good}, Poor: ${s.threshold.needsImprovement}</td>`,t+="</tr>"}),t+="</table>",t+="</div>",t}showReport(){if(this.enabled)return;const e=this.createReport(),t=document.createElement("div");t.innerHTML=e,t.style.cssText="\n      position: fixed;\n      bottom: 20px;\n      right: 20px;\n      background: white;\n      padding: 1rem;\n      border-radius: 0.5rem;\n      box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n      z-index: 9999;\n      max-width: 400px;\n      font-family: monospace;\n      font-size: 12px;\n    ",document.body.appendChild(t),setTimeout(()=>{t.remove()},5e3)}}let D=null;async function U(){const e=(D||(D=new x),D);return await e.init(),e}(async function(){l.restoreUser();try{await S({forceEnable:!1})}catch(s){}try{O({forceEnable:!1})}catch(s){}try{await U()}catch(s){}if(f.init(),"serviceWorker"in navigator)try{await async function(e={}){const t=w();try{return await t.register(e.scriptURL,e.registerOptions),e.onUpdateAvailable&&t.on("updateAvailable",e.onUpdateAvailable),!1!==e.autoCheckUpdates&&setInterval(()=>{t.checkForUpdates()},e.updateInterval||36e5),t}catch(s){throw s}}({onUpdateAvailable:e=>{!function(){const e=document.createElement("div");e.className="sw-update-prompt",e.innerHTML='\n    <div class="sw-update-prompt-content">\n      <p>發現新版本！</p>\n      <button class="btn-update">立即更新</button>\n      <button class="btn-dismiss">稍後再說</button>\n    </div>\n  ';const t=document.createElement("style");t.textContent="\n    .sw-update-prompt {\n      position: fixed;\n      bottom: 20px;\n      right: 20px;\n      background: white;\n      padding: 1rem;\n      border-radius: 0.5rem;\n      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n      z-index: 9999;\n      max-width: 300px;\n    }\n    \n    .sw-update-prompt-content p {\n      margin: 0 0 1rem 0;\n      color: #374151;\n      font-weight: 500;\n    }\n    \n    .sw-update-prompt button {\n      padding: 0.5rem 1rem;\n      border: none;\n      border-radius: 0.375rem;\n      font-weight: 500;\n      cursor: pointer;\n      margin-right: 0.5rem;\n    }\n    \n    .btn-update {\n      background: #667eea;\n      color: white;\n    }\n    \n    .btn-dismiss {\n      background: #e5e7eb;\n      color: #374151;\n    }\n  ",document.head.appendChild(t),document.body.appendChild(e),e.querySelector(".btn-update").addEventListener("click",()=>{w().updateAndReload()}),e.querySelector(".btn-dismiss").addEventListener("click",()=>{e.remove()})}()},autoCheckUpdates:!0,updateInterval:36e5})}catch(s){}const e=function(e={}){return b||(b=new E(e)),b}({rootMargin:"50px",threshold:.01});if(window.addEventListener("popstate",()=>{setTimeout(()=>{e.observe("img[data-src]")},100)}),p.isAuthenticated())try{const e=await p.me();l.setUser(e);const{getErrorTracker:t}=await r(async()=>{const{getErrorTracker:e}=await Promise.resolve().then(()=>A);return{getErrorTracker:e}},void 0);t().setUser(e);const{getAnalytics:s}=await r(async()=>{const{getAnalytics:e}=await Promise.resolve().then(()=>C);return{getAnalytics:e}},void 0);s().setUserId(e.id),s().setUserProperties({role:e.role,created_at:e.createdAt})}catch(s){l.clearUser()}d.on("/",()=>{r(()=>import("./home-CfX1s-zX.js"),__vite__mapDeps([0,1,2])).then(e=>e.renderHome())}),d.on("/login",()=>{r(()=>import("./login-C44FqaBG.js"),__vite__mapDeps([3,4,5,6,7,2])).then(e=>e.renderLogin())}),d.on("/forgot-password",()=>{r(()=>import("./forgotPassword-z1vMQC0F.js"),__vite__mapDeps([8,4,5,6,7,2])).then(e=>e.renderForgotPassword())}),d.on("/posts/:id",({data:e})=>{r(()=>import("./post-DXIU0dxN.js"),__vite__mapDeps([9,1,4,7,2])).then(t=>t.renderPost(e.id))}),d.on("/admin",()=>{h()&&d.navigate("/admin/dashboard")}),d.on("/admin/dashboard",()=>{h()&&r(()=>import("./dashboard-CYw-tU_3.js"),__vite__mapDeps([10,11,4,1,2])).then(e=>e.renderDashboard())}),d.on("/admin/posts",()=>{h()&&r(()=>import("./posts-B_FRwrEJ.js"),__vite__mapDeps([12,11,4,1,13,7,2])).then(e=>e.renderPostsList())}),d.on("/admin/posts/create",()=>{h()&&r(()=>import("./postEditor-DyRcbj-G.js"),__vite__mapDeps([14,11,4,1,6,13,7,2])).then(e=>e.renderPostEditor())}),d.on("/admin/posts/:id/edit",({data:e})=>{h()&&r(()=>import("./postEditor-DyRcbj-G.js"),__vite__mapDeps([14,11,4,1,6,13,7,2])).then(t=>t.renderPostEditor(e.id))}),d.on("/admin/profile",()=>{h()&&r(()=>import("./profile-1wh3CXyn.js"),__vite__mapDeps([15,11,4,16,2])).then(e=>{(new e.default).init()})}),d.on("/admin/users",()=>{h()&&r(()=>import("./users-CWrqSBxp.js"),__vite__mapDeps([17,11,4,16,2,18])).then(e=>{(new e.default).init()})}),d.on("/admin/roles",()=>{h()&&r(()=>import("./roles-B7iRuaIK.js"),__vite__mapDeps([19,11,4,16,2,18])).then(e=>{(new e.default).init()})}),d.on("/admin/statistics",()=>{h()&&r(()=>import("./statistics-B03-dTBG.js"),__vite__mapDeps([20,11,4,21,2])).then(e=>{(new e.default).init()})}),d.on("/admin/tags",()=>{h()&&r(()=>import("./tags-BkxEYtL8.js"),__vite__mapDeps([22,11,4,18,2])).then(e=>{(new e.default).init()})}),d.on("/admin/settings",()=>{h()&&r(()=>import("./settings-Cq_di6Hd.js"),__vite__mapDeps([23,4,7,2])).then(e=>e.renderSettingsPage())}),d.on("/403",()=>{r(()=>import("./forbidden-DFpE16Bi.js"),[]).then(e=>e.render403())}),d.on("/500",()=>{r(()=>import("./serverError-8ryuOcVj.js"),[]).then(e=>e.render500())}),d.notFound(()=>{r(()=>import("./notFound-w_6r5Sfi.js"),__vite__mapDeps([24,2])).then(e=>e.render404())}),d.resolve();const{trackEvent:t}=await r(async()=>{const{trackEvent:e}=await Promise.resolve().then(()=>C);return{trackEvent:e}},void 0);t("app_start",{environment:"production",version:"1.0.0"})})().catch(e=>{r(async()=>{const{captureException:e}=await Promise.resolve().then(()=>A);return{captureException:e}},void 0).then(({captureException:t})=>{t(e,{context:"app_initialization"})})});export{n as A,r as _,p as a,c as b,g as c,i as d,a as e,l as g,d as r,o as t};
