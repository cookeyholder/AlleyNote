# 系統統計頁面開發待辦清單

## 一、後端 API 開發

### 1. 流量統計 API
- [ ] 實作 `/api/v1/statistics/traffic` 端點
  - [ ] 支援月、週、日、時、分等時間粒度
  - [ ] 回傳時間序列資料（適合 Chart.js 折線圖）
  - [ ] 驗收標準：能正確回傳指定時間範圍的流量統計

### 2. 熱門文章 API  
- [x] 實作 `/api/statistics/popular` 端點（已存在，但有權限問題）
  - [x] 支援依瀏覽量排序
  - [x] 支援指定時間範圍
  - [x] 支援分頁與限制筆數
  - [ ] 修復權限配置問題
  - [ ] 驗收標準：admin 角色能正確存取

### 3. 登入失敗統計 API
- [ ] 確保 `/api/v1/activity-logs` 端點正確註冊
  - [ ] 修復路由註冊問題（目前 v1 路由無法存取）
  - [ ] 支援依 action_type 篩選
  - [ ] 驗收標準：能正確回傳登入失敗記錄

### 4. 權限配置
- [ ] 為 super_admin 角色添加統計查詢權限
  - [ ] statistics.read 權限
  - [ ] statistics.* 權限
  - [ ] 驗收標準：admin 用戶能存取所有統計 API

## 二、前端頁面開發

### 1. 流量統計圖表
- [x] 使用 Chart.js 建立時間序列折線圖
  - [x] 支援切換時間粒度（月、週、日、時、分）  
  - [x] 實作時間範圍選擇器
  - [x] 圖表要有適當的標題、座標軸標籤
  - [x] 使用模擬資料展示功能
  - [ ] 接入實際 API（待後端完成）
  - [ ] 驗收標準：圖表正確顯示流量趨勢

### 2. 熱門文章排行榜
- [x] 建立熱門文章列表元件
  - [x] 顯示文章標題、瀏覽量
  - [x] 排名前三名有特殊樣式
  - [x] 使用模擬資料展示功能
  - [ ] 接入實際 API（待後端完成）
  - [ ] 驗收標準：正確顯示前 10 篇熱門文章

### 3. 登入失敗統計圖表
- [x] 建立登入失敗統計區塊
  - [x] 顯示總失敗次數
  - [x] 列出失敗最多的帳號（前 10 名）
  - [x] 使用圖表視覺化失敗趨勢（長條圖）
  - [x] 使用模擬資料展示功能
  - [ ] 接入實際 API（待後端完成）
  - [ ] 驗收標準：正確顯示登入失敗資料

### 4. 統計卡片
- [x] 顯示總文章數、活躍使用者、新使用者、總瀏覽量
  - [x] 卡片設計美觀
  - [x] 資料格式化顯示
  - [x] 使用模擬資料
  - [ ] 接入實際 API（待後端完成）

### 5. 互動功能
- [x] 時間範圍切換（今日、本週、本月）
  - [x] 按鈕狀態切換正確
  - [x] 資料跟隨時間範圍更新
- [x] 刷新按鈕
  - [x] 可手動刷新統計資料
  - [x] 顯示刷新成功提示

## 三、整合與測試

### 1. 前後端整合
- [ ] 確保前端 API 呼叫正確
- [ ] 處理錯誤情況與載入狀態（已完成）
- [x] 實作資料重新整理功能
- [ ] 修復權限與路由問題
- [ ] 驗收標準：頁面功能正常運作

### 2. E2E 測試
- [ ] 使用 Playwright 建立統計頁面 E2E 測試
  - [ ] 測試頁面載入
  - [ ] 測試圖表渲染
  - [ ] 測試時間範圍切換
  - [ ] 測試資料刷新
- [ ] 驗收標準：所有 E2E 測試通過

### 3. 程式碼品質檢查
- [ ] PHPStan Level 10 檢查通過
- [ ] PHP CS Fixer 檢查通過
- [ ] 驗收標準：所有檢查工具無錯誤

## 四、待修復問題

### 高優先級
1. ❌ **路由問題**：`/api/v1/*` 路由無法存取（404 錯誤）
   - 影響：活動日誌 API、其他 v1 API 都無法使用
   - 需要：檢查路由註冊邏輯

2. ❌ **權限問題**：`/api/statistics/*` 端點回傳權限不足錯誤
   - 影響：統計概覽、熱門內容等 API 無法存取
   - 需要：為 super_admin 角色添加統計查詢權限

### 中優先級
3. [ ] **Chart.js 圖表初始化**：雖已配置，但需確認實際資料載入後是否正確渲染

### 低優先級
4. [ ] **系統資訊 API**：資料庫大小、快取使用率等系統資訊尚未實作

## 五、已完成功能

### 前端實作
- ✅ 統計頁面基礎架構
- ✅ Chart.js 整合與配置
- ✅ 流量趨勢圖配置（折線圖）
- ✅ 登入失敗趨勢圖配置（長條圖）
- ✅ 熱門文章列表元件
- ✅ 登入失敗統計元件
- ✅ 統計卡片元件
- ✅ 時間範圍切換功能
- ✅ 刷新按鈕功能
- ✅ 載入狀態處理
- ✅ 錯誤處理
- ✅ 模擬資料展示

### 設計與 UI
- ✅ RWD 響應式設計
- ✅ 圖表配色符合系統設計
- ✅ 無資料情況的顯示處理
- ✅ 排名樣式（前三名特殊標記）

---

## 下一步行動

1. **修復路由問題**
   - 檢查 `/api/v1/*` 路由為何無法存取
   - 確保路由正確註冊到系統

2. **修復權限問題** 
   - 為 super_admin 角色添加統計相關權限
   - 更新 Seeder 或權限配置

3. **API 整合測試**
   - 修復問題後，將模擬資料替換為實際 API 呼叫
   - 測試所有 API 端點

4. **E2E 測試**
   - 撰寫完整的自動化測試

---

## 技術債務與改進建議

- 考慮實作統計資料快取機制（減少資料庫負載）
- 支援匯出統計報表功能（CSV/PDF）
- 新增即時更新功能（WebSocket/Server-Sent Events）
- 支援自訂時間範圍選擇器
- 新增更多視覺化圖表類型（圓餅圖、雷達圖等）
- 實作統計資料比較功能（與上期對比）

