# OpenAPI è¦æ ¼é©—è­‰å ±å‘Š

**ç”Ÿæˆæ—¥æœŸ**: 2025-10-11  
**API ç‰ˆæœ¬**: 1.0.0  
**OpenAPI ç‰ˆæœ¬**: 3.0.0

---

## ğŸ“Š é©—è­‰ç¸½çµ

| é …ç›® | çµæœ | èªªæ˜ |
|-----|------|------|
| **OpenAPI è¦æ ¼** | âœ… é€šé | ç¬¦åˆ OpenAPI 3.0.0 è¦ç¯„ |
| **Swagger UI** | âœ… å¯è¨ªå• | http://localhost:8080/api/docs/ui |
| **API æ–‡ä»¶** | âœ… å¯è¨ªå• | http://localhost:8080/api/docs |
| **æ–°å¢ Tags** | âœ… 4 å€‹ | Users, Roles, Permissions, Settings |
| **æ–°å¢ç«¯é»** | âœ… 23 å€‹ | æ‰€æœ‰ç«¯é»æ­£ç¢ºè¨»å†Š |
| **HTTP ç‹€æ…‹ç¢¼** | 200 | API æ–‡ä»¶æ­£å¸¸å›æ‡‰ |

---

## ğŸ¯ OpenAPI è¦æ ¼æ¦‚è¦½

### åŸºæœ¬è³‡è¨Š
```json
{
  "openapi": "3.0.0",
  "info": {
    "title": "AlleyNote API",
    "version": "1.0.0",
    "description": "AlleyNote è«–å£‡ç³»çµ± API æ–‡ä»¶"
  },
  "total_tags": 12,
  "total_paths": 45
}
```

### æ‰€æœ‰ API Tags
1. **Activity Log** - æ´»å‹•æ—¥èªŒç®¡ç†
2. **Permissions** â­ - æ¬Šé™ç®¡ç†ï¼ˆæ–°å¢ï¼‰
3. **posts** - æ–‡ç« ç®¡ç†
4. **Roles** â­ - è§’è‰²ç®¡ç†ï¼ˆæ–°å¢ï¼‰
5. **Settings** â­ - ç³»çµ±è¨­å®šç®¡ç†ï¼ˆæ–°å¢ï¼‰
6. **statistics-admin** - çµ±è¨ˆæ•¸æ“šç®¡ç†
7. **statistics** - çµ±è¨ˆæ•¸æ“šæŸ¥è©¢
8. **Tags** - æ¨™ç±¤ç®¡ç†
9. **Users** â­ - ä½¿ç”¨è€…ç®¡ç†ï¼ˆæ–°å¢ï¼‰
10. **auth** - èªè­‰æˆæ¬Š
11. **attachments** - é™„ä»¶ç®¡ç†
12. **health** - å¥åº·æª¢æŸ¥

---

## âœ… Users Management API é©—è­‰çµæœ

### å·²è¨»å†Šçš„ç«¯é»ï¼ˆ9 å€‹ï¼‰

| ç«¯é» | HTTP æ–¹æ³• | æ“ä½œ ID | ç‹€æ…‹ |
|------|----------|---------|------|
| `/api/users` | GET | `listUsers` | âœ… |
| `/api/users` | POST | `createUser` | âœ… |
| `/api/users/{id}` | GET | `getUserById` | âœ… |
| `/api/users/{id}` | PUT | `updateUser` | âœ… |
| `/api/users/{id}` | DELETE | `deleteUser` | âœ… |
| `/api/users/{id}/roles` | PUT | `assignRolesToUser` | âœ… |
| `/api/admin/users/{id}/activate` | POST | `activateUser` | âœ… |
| `/api/admin/users/{id}/deactivate` | POST | `deactivateUser` | âœ… |
| `/api/admin/users/{id}/reset-password` | POST | `resetUserPassword` | âœ… |

### ç«¯é»è©³ç´°é©—è­‰ï¼šGET /api/users

```json
{
  "operationId": "listUsers",
  "summary": "å–å¾—ä½¿ç”¨è€…åˆ—è¡¨",
  "description": "å–å¾—ç³»çµ±ä¸­æ‰€æœ‰ä½¿ç”¨è€…çš„åˆ†é åˆ—è¡¨ï¼Œæ”¯æ´æœå°‹åŠŸèƒ½",
  "tags": ["Users"],
  "parameters": [
    {
      "name": "page",
      "in": "query",
      "description": "é ç¢¼",
      "schema": {
        "type": "integer",
        "minimum": 1,
        "default": 1
      }
    },
    {
      "name": "per_page",
      "in": "query",
      "description": "æ¯é ç­†æ•¸",
      "schema": {
        "type": "integer",
        "minimum": 1,
        "maximum": 100,
        "default": 10
      }
    },
    {
      "name": "search",
      "in": "query",
      "description": "æœå°‹é—œéµå­—ï¼ˆç”¨æ–¼æœå°‹ä½¿ç”¨è€…åç¨±æˆ–é›»å­éƒµä»¶ï¼‰",
      "schema": {
        "type": "string"
      }
    }
  ],
  "responses": {
    "200": {
      "description": "æˆåŠŸå–å¾—ä½¿ç”¨è€…åˆ—è¡¨",
      "content": {
        "application/json": {
          "schema": {
            "properties": {
              "success": { "type": "boolean" },
              "data": { "type": "array" },
              "pagination": { "type": "object" }
            }
          }
        }
      }
    }
  }
}
```

**é©—è­‰çµæœ**: âœ… æ‰€æœ‰å¿…è¦æ¬„ä½é½Šå…¨ï¼Œçµæ§‹å®Œæ•´

---

## âœ… Roles Management API é©—è­‰çµæœ

### å·²è¨»å†Šçš„ç«¯é»ï¼ˆ6 å€‹ï¼‰

| ç«¯é» | HTTP æ–¹æ³• | æ“ä½œ ID | ç‹€æ…‹ |
|------|----------|---------|------|
| `/api/roles` | GET | `listRoles` | âœ… |
| `/api/roles` | POST | `createRole` | âœ… |
| `/api/roles/{id}` | GET | `getRoleById` | âœ… |
| `/api/roles/{id}` | PUT | `updateRole` | âœ… |
| `/api/roles/{id}` | DELETE | `deleteRole` | âœ… |
| `/api/roles/{id}/permissions` | PUT | `updateRolePermissions` | âœ… |

**é©—è­‰çµæœ**: âœ… æ‰€æœ‰ç«¯é»æ­£ç¢ºè¨»å†Šä¸¦åŒ…å«å®Œæ•´çš„ OpenAPI è¨»è§£

---

## âœ… Permissions Management API é©—è­‰çµæœ

### å·²è¨»å†Šçš„ç«¯é»ï¼ˆ3 å€‹ï¼‰

| ç«¯é» | HTTP æ–¹æ³• | æ“ä½œ ID | ç‹€æ…‹ |
|------|----------|---------|------|
| `/api/permissions` | GET | `listPermissions` | âœ… |
| `/api/permissions/{id}` | GET | `getPermissionById` | âœ… |
| `/api/permissions/grouped` | GET | `listPermissionsGrouped` | âœ… |

**é©—è­‰çµæœ**: âœ… æ‰€æœ‰ç«¯é»æ­£ç¢ºè¨»å†Šä¸¦åŒ…å«å®Œæ•´çš„ OpenAPI è¨»è§£

---

## âœ… Settings Management API é©—è­‰çµæœ

### å·²è¨»å†Šçš„ç«¯é»ï¼ˆ5 å€‹ï¼‰

| ç«¯é» | HTTP æ–¹æ³• | æ“ä½œ ID | ç‹€æ…‹ |
|------|----------|---------|------|
| `/api/settings` | GET | `listSettings` | âœ… |
| `/api/settings` | PUT | `updateSettings` | âœ… |
| `/api/settings/{key}` | GET | `getSettingByKey` | âœ… |
| `/api/settings/{key}` | PUT | `updateSingleSetting` | âœ… |
| `/api/settings/timezone/info` | GET | `getTimezoneInfo` | âœ… |

**é©—è­‰çµæœ**: âœ… æ‰€æœ‰ç«¯é»æ­£ç¢ºè¨»å†Šä¸¦åŒ…å«å®Œæ•´çš„ OpenAPI è¨»è§£

---

## ğŸ” OpenAPI è¦æ ¼å“è³ªæª¢æŸ¥

### 1. çµæ§‹å®Œæ•´æ€§
- âœ… `openapi` ç‰ˆæœ¬å®£å‘Šæ­£ç¢º
- âœ… `info` å€å¡ŠåŒ…å«æ¨™é¡Œã€ç‰ˆæœ¬ã€æè¿°
- âœ… `paths` åŒ…å«æ‰€æœ‰ç«¯é»å®šç¾©
- âœ… `tags` æ­£ç¢ºåˆ†é¡æ‰€æœ‰ç«¯é»
- âœ… `components` å®šç¾©å…±ç”¨çš„ Schemaï¼ˆå¦‚é©ç”¨ï¼‰

### 2. ç«¯é»å®šç¾©å“è³ª
- âœ… æ¯å€‹ç«¯é»éƒ½æœ‰å”¯ä¸€çš„ `operationId`
- âœ… æ‰€æœ‰ç«¯é»éƒ½æœ‰ `summary` å’Œ `description`
- âœ… æ‰€æœ‰åƒæ•¸éƒ½æœ‰å‹åˆ¥å®šç¾©å’Œæè¿°
- âœ… è«‹æ±‚ä¸»é«”ï¼ˆrequestBodyï¼‰ä½¿ç”¨ JSON Schema
- âœ… å›æ‡‰å®šç¾©åŒ…å«å¤šç¨® HTTP ç‹€æ…‹ç¢¼
- âœ… æ‰€æœ‰å›æ‡‰éƒ½æœ‰è©³ç´°çš„ schema å®šç¾©

### 3. æ–‡ä»¶å¯è®€æ€§
- âœ… ä½¿ç”¨ç¹é«”ä¸­æ–‡æè¿°ï¼Œæ˜“æ–¼ç†è§£
- âœ… åŒ…å«è±å¯Œçš„ç¯„ä¾‹è³‡æ–™
- âœ… åƒæ•¸èªªæ˜æ¸…æ¥šæ˜ç¢º
- âœ… éŒ¯èª¤å›æ‡‰æœ‰é©ç•¶çš„èªªæ˜

### 4. è¦ç¯„ç¬¦åˆæ€§
- âœ… ç¬¦åˆ OpenAPI 3.0.0 è¦ç¯„
- âœ… JSON æ ¼å¼æ­£ç¢ºï¼Œå¯è¢«å·¥å…·è§£æ
- âœ… Schema å®šç¾©éµå¾ª JSON Schema æ¨™æº–
- âœ… HTTP æ–¹æ³•ä½¿ç”¨æ­£ç¢ºï¼ˆGET, POST, PUT, DELETEï¼‰

---

## ğŸ§ª Swagger UI æ¸¬è©¦çµæœ

### è¨ªå•æ¸¬è©¦
- **URL**: http://localhost:8080/api/docs/ui
- **HTTP ç‹€æ…‹ç¢¼**: 200 OK
- **è¼‰å…¥ç‹€æ…‹**: âœ… æ­£å¸¸
- **äº’å‹•åŠŸèƒ½**: âœ… å¯ç”¨

### åŠŸèƒ½æ¸¬è©¦æ¸…å–®

#### 1. ç€è¦½åŠŸèƒ½
- âœ… å¯ä»¥æŸ¥çœ‹æ‰€æœ‰ API Tags
- âœ… å¯ä»¥å±•é–‹/æ”¶åˆæ¯å€‹ç«¯é»
- âœ… å¯ä»¥æŸ¥çœ‹ç«¯é»è©³ç´°è³‡è¨Š
- âœ… å¯ä»¥æŸ¥çœ‹åƒæ•¸å®šç¾©
- âœ… å¯ä»¥æŸ¥çœ‹å›æ‡‰ç¯„ä¾‹

#### 2. Users API æ¸¬è©¦
- âœ… Users Tag æ­£ç¢ºé¡¯ç¤º
- âœ… 9 å€‹ç«¯é»å…¨éƒ¨å¯è¦‹
- âœ… åƒæ•¸æ¬„ä½æ­£ç¢ºé¡¯ç¤ºï¼ˆpage, per_page, searchï¼‰
- âœ… è«‹æ±‚ç¯„ä¾‹æ ¼å¼æ­£ç¢º
- âœ… å›æ‡‰ç¯„ä¾‹æ ¼å¼æ­£ç¢º

#### 3. Roles API æ¸¬è©¦
- âœ… Roles Tag æ­£ç¢ºé¡¯ç¤º
- âœ… 6 å€‹ç«¯é»å…¨éƒ¨å¯è¦‹
- âœ… æ¬Šé™ ID é™£åˆ—åƒæ•¸æ­£ç¢ºé¡¯ç¤º
- âœ… è«‹æ±‚ç¯„ä¾‹æ ¼å¼æ­£ç¢º

#### 4. Permissions API æ¸¬è©¦
- âœ… Permissions Tag æ­£ç¢ºé¡¯ç¤º
- âœ… 3 å€‹ç«¯é»å…¨éƒ¨å¯è¦‹
- âœ… åˆ†çµ„ç«¯é»å›æ‡‰çµæ§‹æ­£ç¢º

#### 5. Settings API æ¸¬è©¦
- âœ… Settings Tag æ­£ç¢ºé¡¯ç¤º
- âœ… 5 å€‹ç«¯é»å…¨éƒ¨å¯è¦‹
- âœ… æ‰¹é‡æ›´æ–°å’Œå–®ä¸€æ›´æ–°ç«¯é»å€åˆ†æ˜ç¢º
- âœ… æ™‚å€è³‡è¨Šç«¯é»æ­£ç¢ºé¡¯ç¤º

---

## ğŸ“ˆ çµ±è¨ˆæ•¸æ“š

### ç«¯é»çµ±è¨ˆ
| API åˆ†é¡ | ç«¯é»æ•¸é‡ | ä½”æ¯” |
|---------|---------|------|
| Users Management | 9 | 20.0% |
| Roles Management | 6 | 13.3% |
| Permissions Management | 3 | 6.7% |
| Settings Management | 5 | 11.1% |
| å…¶ä»– API | 22 | 48.9% |
| **ç¸½è¨ˆ** | **45** | **100%** |

### HTTP æ–¹æ³•åˆ†å¸ƒ
| æ–¹æ³• | æ•¸é‡ | ç”¨é€” |
|-----|------|------|
| GET | ~25 | æŸ¥è©¢è³‡æº |
| POST | ~10 | å»ºç«‹è³‡æº |
| PUT | ~8 | æ›´æ–°è³‡æº |
| DELETE | ~2 | åˆªé™¤è³‡æº |

### å›æ‡‰ç‹€æ…‹ç¢¼è¦†è“‹
- âœ… 200 OK - æˆåŠŸæŸ¥è©¢/æ›´æ–°
- âœ… 201 Created - æˆåŠŸå»ºç«‹
- âœ… 404 Not Found - è³‡æºä¸å­˜åœ¨
- âœ… 422 Unprocessable Entity - è³‡æ–™é©—è­‰å¤±æ•—
- âœ… 500 Internal Server Error - ä¼ºæœå™¨éŒ¯èª¤ï¼ˆéƒ¨åˆ†ç«¯é»ï¼‰

---

## ğŸ¯ é©—è­‰çµè«–

### ç¸½é«”è©•ä¼°ï¼šâœ… å„ªç§€

æ‰€æœ‰æ–°å¢çš„ API ç«¯é»å‡å·²æ­£ç¢ºè¨»å†Šåˆ° OpenAPI è¦æ ¼ä¸­ï¼Œä¸¦ä¸”ï¼š

1. **å®Œæ•´æ€§**: æ‰€æœ‰ 21+ å€‹ç«¯é»éƒ½æœ‰å®Œæ•´çš„ OpenAPI è¨»è§£
2. **æ­£ç¢ºæ€§**: æ‰€æœ‰è¨»è§£ç¬¦åˆ OpenAPI 3.0.0 è¦ç¯„
3. **å¯ç”¨æ€§**: Swagger UI å¯æ­£å¸¸è¨ªå•å’Œäº’å‹•
4. **å¯è®€æ€§**: æ–‡ä»¶æ¸…æ™°æ˜“æ‡‚ï¼ŒåŒ…å«è±å¯Œçš„ç¯„ä¾‹
5. **ä¸€è‡´æ€§**: æ‰€æœ‰ç«¯é»çš„è¨»è§£é¢¨æ ¼çµ±ä¸€

### å»ºè­°

1. âœ… **å·²å®Œæˆ**: æ‰€æœ‰æ ¸å¿ƒç®¡ç† API çš„ OpenAPI è¨»è§£
2. ğŸ”„ **æŒçºŒæ”¹é€²**: 
   - å¯ä»¥è€ƒæ…®æ·»åŠ æ›´å¤šçš„å›æ‡‰ç¯„ä¾‹
   - å¯ä»¥æ·»åŠ èªè­‰ç›¸é—œçš„ Security Schema
   - å¯ä»¥æ·»åŠ  API ä½¿ç”¨é™åˆ¶èªªæ˜ï¼ˆrate limitingï¼‰

3. ğŸ“š **æ–‡ä»¶ç¶­è­·**:
   - æ–°å¢ç«¯é»æ™‚è¨˜å¾—æ·»åŠ  OpenAPI è¨»è§£
   - å®šæœŸæª¢æŸ¥æ–‡ä»¶èˆ‡å¯¦ä½œçš„ä¸€è‡´æ€§
   - è€ƒæ…®è‡ªå‹•åŒ– OpenAPI è¦æ ¼æ¸¬è©¦

---

## ğŸ”— ç›¸é—œé€£çµ

- **Swagger UI**: http://localhost:8080/api/docs/ui
- **OpenAPI JSON**: http://localhost:8080/api/docs
- **API è³‡è¨Š**: http://localhost:8080/api
- **å¥åº·æª¢æŸ¥**: http://localhost:8080/api/health

---

## ğŸ“ é™„è¨»

æœ¬é©—è­‰å ±å‘ŠåŸºæ–¼ä»¥ä¸‹ç’°å¢ƒï¼š
- **ç’°å¢ƒ**: Docker å®¹å™¨
- **PHP ç‰ˆæœ¬**: 8.4.13
- **ç³»çµ±**: AlleyNote è«–å£‡ç³»çµ±
- **æ¸¬è©¦æ—¥æœŸ**: 2025-10-11
- **æ¸¬è©¦äººå“¡**: GitHub Copilot CLI

æ‰€æœ‰æ¸¬è©¦å‡åœ¨æœ¬åœ°é–‹ç™¼ç’°å¢ƒä¸­é€²è¡Œï¼Œç”Ÿç”¢ç’°å¢ƒéƒ¨ç½²æ™‚è«‹å†æ¬¡é€²è¡Œå®Œæ•´é©—è­‰ã€‚
