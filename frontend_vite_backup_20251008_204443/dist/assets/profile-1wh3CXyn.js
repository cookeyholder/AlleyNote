import{r as n,b as e}from"./DashboardLayout-BjmJ-OJc.js";import{a as t}from"./index-DHmEDfox.js";import{usersAPI as s}from"./users-nxFUwfS-.js";import{t as r}from"./toast-ChPGQGGG.js";import"./vendor-core-DW9qjkZC.js";class o{constructor(){this.user=null,this.isEditingInfo=!1,this.isEditingPassword=!1}async init(){await this.loadUserInfo()}async loadUserInfo(){try{const n=await t.me();this.user=n,this.render()}catch(n){r.error("載入使用者資訊失敗")}}render(){const t=`\n      <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">\n        <h1 class="text-3xl font-bold text-modern-900 mb-8">個人資料</h1>\n\n        \x3c!-- 個人資訊卡片 --\x3e\n        <div class="bg-white rounded-2xl border border-modern-200 p-8 mb-6">\n          <div class="flex items-center justify-between mb-6">\n            <h2 class="text-xl font-semibold text-modern-900">基本資訊</h2>\n            <button \n              id="editInfoBtn" \n              class="px-4 py-2 text-sm font-medium text-accent-700 border-2 border-accent-600 rounded-lg hover:bg-accent-50 transition-colors"\n            >\n              ${this.isEditingInfo?"取消編輯":"編輯資訊"}\n            </button>\n          </div>\n\n          ${this.isEditingInfo?this.renderEditInfoForm():this.renderInfoDisplay()}\n        </div>\n\n        \x3c!-- 修改密碼卡片 --\x3e\n        <div class="bg-white rounded-2xl border border-modern-200 p-8">\n          <div class="flex items-center justify-between mb-6">\n            <h2 class="text-xl font-semibold text-modern-900">修改密碼</h2>\n            <button \n              id="editPasswordBtn" \n              class="px-4 py-2 text-sm font-medium text-accent-700 border-2 border-accent-600 rounded-lg hover:bg-accent-50 transition-colors"\n            >\n              ${this.isEditingPassword?"取消":"修改密碼"}\n            </button>\n          </div>\n\n          ${this.isEditingPassword?this.renderPasswordForm():this.renderPasswordPlaceholder()}\n        </div>\n      </div>\n    `;document.getElementById("app").innerHTML=n(t),e(),this.attachEventListeners()}renderInfoDisplay(){return this.user?`\n      <div class="space-y-4">\n        <div class="flex items-center justify-between py-3 border-b border-modern-100">\n          <span class="text-modern-600 font-medium">使用者名稱</span>\n          <span class="text-modern-900">${this.escapeHtml(this.user.username||"-")}</span>\n        </div>\n        <div class="flex items-center justify-between py-3 border-b border-modern-100">\n          <span class="text-modern-600 font-medium">電子郵件</span>\n          <span class="text-modern-900">${this.escapeHtml(this.user.email||"-")}</span>\n        </div>\n        <div class="flex items-center justify-between py-3 border-b border-modern-100">\n          <span class="text-modern-600 font-medium">角色</span>\n          <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${"super_admin"===this.user.role?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800"}">\n            ${"super_admin"===this.user.role?"主管理員":"管理員"}\n          </span>\n        </div>\n        <div class="flex items-center justify-between py-3 border-b border-modern-100">\n          <span class="text-modern-600 font-medium">註冊日期</span>\n          <span class="text-modern-900">${this.formatDate(this.user.created_at)}</span>\n        </div>\n        <div class="flex items-center justify-between py-3">\n          <span class="text-modern-600 font-medium">上次登入</span>\n          <span class="text-modern-900">${this.formatDate(this.user.last_login)}</span>\n        </div>\n      </div>\n    `:'<div class="text-center text-modern-500">載入中...</div>'}renderEditInfoForm(){return this.user?`\n      <form id="editInfoForm" class="space-y-6">\n        <div>\n          <label for="username" class="block text-sm font-medium text-modern-700 mb-2">\n            使用者名稱\n          </label>\n          <input\n            type="text"\n            id="username"\n            name="username"\n            value="${this.escapeHtml(this.user.username||"")}"\n            class="w-full px-4 py-3 rounded-lg border border-modern-300 focus:outline-none focus:ring-2 focus:ring-accent-500"\n            required\n          />\n        </div>\n\n        <div>\n          <label for="email" class="block text-sm font-medium text-modern-700 mb-2">\n            電子郵件\n          </label>\n          <input\n            type="email"\n            id="email"\n            name="email"\n            value="${this.escapeHtml(this.user.email||"")}"\n            class="w-full px-4 py-3 rounded-lg border border-modern-300 focus:outline-none focus:ring-2 focus:ring-accent-500"\n            required\n          />\n        </div>\n\n        <div class="flex justify-end gap-3">\n          <button\n            type="button"\n            id="cancelInfoBtn"\n            class="px-6 py-3 text-sm font-medium text-modern-700 border-2 border-modern-300 rounded-lg hover:bg-modern-50 transition-colors"\n          >\n            取消\n          </button>\n          <button\n            type="submit"\n            class="px-6 py-3 text-sm font-medium text-white bg-accent-600 rounded-lg hover:bg-accent-700 transition-colors"\n          >\n            儲存變更\n          </button>\n        </div>\n      </form>\n    `:""}renderPasswordPlaceholder(){return'\n      <div class="text-center text-modern-500 py-8">\n        <i class="fas fa-lock text-4xl mb-4"></i>\n        <p>點擊「修改密碼」按鈕開始修改您的密碼</p>\n      </div>\n    '}renderPasswordForm(){return'\n      <form id="changePasswordForm" class="space-y-6">\n        <div>\n          <label for="current_password" class="block text-sm font-medium text-modern-700 mb-2">\n            目前密碼\n          </label>\n          <input\n            type="password"\n            id="current_password"\n            name="current_password"\n            class="w-full px-4 py-3 rounded-lg border border-modern-300 focus:outline-none focus:ring-2 focus:ring-accent-500"\n            required\n          />\n        </div>\n\n        <div>\n          <label for="new_password" class="block text-sm font-medium text-modern-700 mb-2">\n            新密碼\n          </label>\n          <input\n            type="password"\n            id="new_password"\n            name="new_password"\n            class="w-full px-4 py-3 rounded-lg border border-modern-300 focus:outline-none focus:ring-2 focus:ring-accent-500"\n            minlength="8"\n            required\n          />\n          <p class="mt-1 text-sm text-modern-500">密碼長度至少 8 個字元</p>\n        </div>\n\n        <div>\n          <label for="new_password_confirmation" class="block text-sm font-medium text-modern-700 mb-2">\n            確認新密碼\n          </label>\n          <input\n            type="password"\n            id="new_password_confirmation"\n            name="new_password_confirmation"\n            class="w-full px-4 py-3 rounded-lg border border-modern-300 focus:outline-none focus:ring-2 focus:ring-accent-500"\n            minlength="8"\n            required\n          />\n        </div>\n\n        <div class="flex justify-end gap-3">\n          <button\n            type="button"\n            id="cancelPasswordBtn"\n            class="px-6 py-3 text-sm font-medium text-modern-700 border-2 border-modern-300 rounded-lg hover:bg-modern-50 transition-colors"\n          >\n            取消\n          </button>\n          <button\n            type="submit"\n            class="px-6 py-3 text-sm font-medium text-white bg-accent-600 rounded-lg hover:bg-accent-700 transition-colors"\n          >\n            修改密碼\n          </button>\n        </div>\n      </form>\n    '}attachEventListeners(){const n=document.getElementById("editInfoBtn");n&&n.addEventListener("click",()=>{this.isEditingInfo=!this.isEditingInfo,this.render()});const e=document.getElementById("cancelInfoBtn");e&&e.addEventListener("click",()=>{this.isEditingInfo=!1,this.render()});const t=document.getElementById("editInfoForm");t&&t.addEventListener("submit",async n=>{n.preventDefault(),await this.handleUpdateInfo(new FormData(t))});const s=document.getElementById("editPasswordBtn");s&&s.addEventListener("click",()=>{this.isEditingPassword=!this.isEditingPassword,this.render()});const r=document.getElementById("cancelPasswordBtn");r&&r.addEventListener("click",()=>{this.isEditingPassword=!1,this.render()});const o=document.getElementById("changePasswordForm");o&&o.addEventListener("submit",async n=>{n.preventDefault(),await this.handleChangePassword(new FormData(o))})}async handleUpdateInfo(n){try{const e={username:n.get("username"),email:n.get("email")};if(!e.username||e.username.length<3)return void r.error("使用者名稱至少需要 3 個字元");if(!e.email||!this.isValidEmail(e.email))return void r.error("請輸入有效的電子郵件");await s.update(this.user.id,e),r.success("個人資訊更新成功"),this.isEditingInfo=!1,await this.loadUserInfo()}catch(e){r.error(e.message||"更新個人資訊失敗")}}async handleChangePassword(n){try{const e=n.get("current_password"),t=n.get("new_password"),o=n.get("new_password_confirmation");if(!e)return void r.error("請輸入目前密碼");if(!t||t.length<8)return void r.error("新密碼長度至少需要 8 個字元");if(t!==o)return void r.error("新密碼與確認密碼不符");if(e===t)return void r.error("新密碼不能與目前密碼相同");await s.update(this.user.id,{current_password:e,password:t,password_confirmation:o}),r.success("密碼修改成功"),this.isEditingPassword=!1,this.render()}catch(e){r.error(e.message||"修改密碼失敗")}}escapeHtml(n){const e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return n?String(n).replace(/[&<>"']/g,n=>e[n]):""}formatDate(n){if(!n)return"-";const e=new Date(n);return new Intl.DateTimeFormat("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(e)}isValidEmail(n){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n)}}export{o as default};
