import{r as t,b as e}from"./DashboardLayout-BjmJ-OJc.js";import{c as s,d as n}from"./index-DHmEDfox.js";import{t as a}from"./toast-ChPGQGGG.js";import{C as r,L as i,B as o,D as d,a as l,b as c,P as h,c as p,d as v,A as u,p as g,e as b,f as m}from"./vendor-chart-CJITHfyz.js";import"./vendor-core-DW9qjkZC.js";const x={overview:async()=>(await s.get(n.STATISTICS.OVERVIEW)).data,posts:async(t={})=>(await s.get(n.STATISTICS.POSTS,{params:t})).data,views:async(t={})=>(await s.get(n.STATISTICS.VIEWS,{params:t})).data};r.register(i,o,d,l,c,h,p,v,u,g,b,m);class w{constructor(){this.overview=null,this.postsStats=null,this.popularPosts=null,this.loading=!1,this.charts={},this.dateRange="last_30_days"}async init(){await this.loadStatistics()}async loadStatistics(){var t,e;try{this.loading=!0,this.render();const[s,n,a]=await Promise.all([x.getOverview({period:this.dateRange}),x.getPostsStats({period:this.dateRange}),x.getPopular({period:this.dateRange,limit:10})]);this.overview=s,this.postsStats=n,this.popularPosts=(null==(e=null==(t=null==a?void 0:a.data)?void 0:t.top_posts)?void 0:e.by_views)||[],this.loading=!1,this.render(),this.initCharts()}catch(s){a.error("載入統計資料失敗"),this.loading=!1,this.render()}}render(){const s=`\n      <div class="max-w-7xl mx-auto">\n        <div class="flex items-center justify-between mb-8">\n          <h1 class="text-3xl font-bold text-modern-900">系統統計</h1>\n          \n          <div class="flex items-center gap-3">\n            <label for="dateRange" class="text-sm font-medium text-modern-700">時間範圍：</label>\n            <select \n              id="dateRange" \n              class="px-4 py-2 rounded-lg border border-modern-300 focus:outline-none focus:ring-2 focus:ring-accent-500"\n            >\n              <option value="last_7_days" ${"last_7_days"===this.dateRange?"selected":""}>最近 7 天</option>\n              <option value="last_30_days" ${"last_30_days"===this.dateRange?"selected":""}>最近 30 天</option>\n              <option value="last_90_days" ${"last_90_days"===this.dateRange?"selected":""}>最近 90 天</option>\n              <option value="this_year" ${"this_year"===this.dateRange?"selected":""}>今年</option>\n            </select>\n          </div>\n        </div>\n\n        ${this.loading?this.renderLoading():this.renderContent()}\n      </div>\n    `;document.getElementById("app").innerHTML=t(s),e(),this.attachEventListeners()}renderLoading(){return'\n      <div class="bg-white rounded-2xl border border-modern-200 p-8">\n        <div class="text-center text-modern-500">\n          <i class="fas fa-spinner fa-spin text-4xl mb-4"></i>\n          <p>載入中...</p>\n        </div>\n      </div>\n    '}renderContent(){return`\n      \x3c!-- 概覽卡片 --\x3e\n      ${this.renderOverviewCards()}\n\n      \x3c!-- 圖表區域 --\x3e\n      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">\n        \x3c!-- 文章發布趨勢 --\x3e\n        <div class="bg-white rounded-2xl border border-modern-200 p-6">\n          <h3 class="text-lg font-semibold text-modern-900 mb-4">文章發布趨勢</h3>\n          <canvas id="postsChart"></canvas>\n        </div>\n\n        \x3c!-- 文章狀態分佈 --\x3e\n        <div class="bg-white rounded-2xl border border-modern-200 p-6">\n          <h3 class="text-lg font-semibold text-modern-900 mb-4">文章狀態分佈</h3>\n          <canvas id="statusChart"></canvas>\n        </div>\n      </div>\n\n      \x3c!-- 熱門文章排行榜 --\x3e\n      ${this.renderPopularPosts()}\n    `}renderOverviewCards(){var t,e,s,n,a,r;if(!this.overview)return"";return`\n      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">\n        ${[{title:"總文章數",value:(null==(t=this.overview.posts)?void 0:t.total)||0,icon:"📝",color:"blue",change:(null==(e=this.overview.posts)?void 0:e.growth)||0},{title:"已發布",value:(null==(s=this.overview.posts)?void 0:s.published)||0,icon:"✅",color:"green"},{title:"草稿",value:(null==(n=this.overview.posts)?void 0:n.draft)||0,icon:"📋",color:"yellow"},{title:"總瀏覽數",value:(null==(a=this.overview.interactions)?void 0:a.views)||0,icon:"👁️",color:"purple",change:(null==(r=this.overview.interactions)?void 0:r.views_growth)||0}].map(t=>this.renderStatCard(t)).join("")}\n      </div>\n    `}renderStatCard(t){const e={blue:{bg:"bg-blue-50",text:"text-blue-700",border:"border-blue-200"},green:{bg:"bg-green-50",text:"text-green-700",border:"border-green-200"},yellow:{bg:"bg-yellow-50",text:"text-yellow-700",border:"border-yellow-200"},purple:{bg:"bg-purple-50",text:"text-purple-700",border:"border-purple-200"}},s=e[t.color]||e.blue,n=void 0!==t.change,a=t.change>0;return`\n      <div class="bg-white rounded-2xl border ${s.border} p-6">\n        <div class="flex items-center justify-between mb-4">\n          <span class="text-3xl">${t.icon}</span>\n          ${n?`\n            <span class="text-sm font-medium ${a?"text-green-600":"text-red-600"}">\n              ${a?"↑":"↓"} ${Math.abs(t.change)}%\n            </span>\n          `:""}\n        </div>\n        <h3 class="text-sm font-medium text-modern-600 mb-1">${t.title}</h3>\n        <p class="text-3xl font-bold ${s.text}">${this.formatNumber(t.value)}</p>\n      </div>\n    `}renderPopularPosts(){return this.popularPosts&&0!==this.popularPosts.length?`\n      <div class="bg-white rounded-2xl border border-modern-200 p-6">\n        <h3 class="text-lg font-semibold text-modern-900 mb-4">熱門文章排行榜（依瀏覽數）</h3>\n        <div class="space-y-3">\n          ${this.popularPosts.map((t,e)=>this.renderPopularPostItem(t,e)).join("")}\n        </div>\n      </div>\n    `:'\n        <div class="bg-white rounded-2xl border border-modern-200 p-8">\n          <h3 class="text-lg font-semibold text-modern-900 mb-4">熱門文章排行榜</h3>\n          <div class="text-center text-modern-500">\n            <p>暫無資料</p>\n          </div>\n        </div>\n      '}renderPopularPostItem(t,e){return`\n      <div class="flex items-center justify-between p-4 rounded-lg hover:bg-modern-50 transition-colors">\n        <div class="flex items-center gap-4 flex-1">\n          <span class="text-2xl w-8 text-center">${["🥇","🥈","🥉"][e]||`${e+1}.`}</span>\n          <div class="flex-1">\n            <h4 class="font-medium text-modern-900">${this.escapeHtml(t.title)}</h4>\n            <p class="text-sm text-modern-500">作者：${this.escapeHtml(t.author_name||"未知")}</p>\n          </div>\n        </div>\n        <div class="text-right">\n          <p class="text-lg font-semibold text-accent-600">${this.formatNumber(t.views)}</p>\n          <p class="text-xs text-modern-500">瀏覽次數</p>\n        </div>\n      </div>\n    `}initCharts(){Object.values(this.charts).forEach(t=>t.destroy()),this.charts={},this.initPostsChart(),this.initStatusChart()}initPostsChart(){var t;const e=document.getElementById("postsChart");if(!e||!(null==(t=this.postsStats)?void 0:t.timeline))return;const s=this.postsStats.timeline,n=Object.keys(s),a=Object.values(s);this.charts.postsChart=new r(e,{type:"line",data:{labels:n,datasets:[{label:"文章發布數",data:a,borderColor:"rgb(59, 130, 246)",backgroundColor:"rgba(59, 130, 246, 0.1)",tension:.4,fill:!0}]},options:{responsive:!0,maintainAspectRatio:!0,plugins:{legend:{display:!1},tooltip:{mode:"index",intersect:!1}},scales:{y:{beginAtZero:!0,ticks:{precision:0}}}}})}initStatusChart(){var t,e,s;const n=document.getElementById("statusChart");if(!n||!this.overview)return;const a=[(null==(t=this.overview.posts)?void 0:t.published)||0,(null==(e=this.overview.posts)?void 0:e.draft)||0,(null==(s=this.overview.posts)?void 0:s.archived)||0];this.charts.statusChart=new r(n,{type:"doughnut",data:{labels:["已發布","草稿","已封存"],datasets:[{data:a,backgroundColor:["rgba(34, 197, 94, 0.8)","rgba(251, 191, 36, 0.8)","rgba(156, 163, 175, 0.8)"],borderColor:["rgb(34, 197, 94)","rgb(251, 191, 36)","rgb(156, 163, 175)"],borderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!0,plugins:{legend:{position:"bottom"}}}})}attachEventListeners(){const t=document.getElementById("dateRange");t&&t.addEventListener("change",async t=>{this.dateRange=t.target.value,await this.loadStatistics()})}escapeHtml(t){const e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return t?String(t).replace(/[&<>"']/g,t=>e[t]):""}formatNumber(t){return t>=1e6?(t/1e6).toFixed(1)+"M":t>=1e3?(t/1e3).toFixed(1)+"K":t.toString()}}export{w as default};
