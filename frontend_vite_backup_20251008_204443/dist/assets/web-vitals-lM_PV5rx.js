var e=Object.defineProperty,t=(t,n,i)=>((t,n,i)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[n]=i)(t,"symbol"!=typeof n?n+"":n,i);let n=-1;const i=e=>{addEventListener("pageshow",t=>{t.persisted&&(n=t.timeStamp,e(t))},!0)},r=(e,t,n,i)=>{let r,s;return o=>{var a,l;t.value>=0&&(o||i)&&(s=t.value-(r??0),(s||void 0===r)&&(r=t.value,t.delta=s,t.rating=(a=t.value)>(l=n)[1]?"poor":a>l[0]?"needs-improvement":"good",e(t)))}},s=e=>{requestAnimationFrame(()=>requestAnimationFrame(()=>e()))},o=()=>{const e=performance.getEntriesByType("navigation")[0];if(e&&e.responseStart>0&&e.responseStart<performance.now())return e},a=()=>{const e=o();return(null==e?void 0:e.activationStart)??0},l=(e,t=-1)=>{const i=o();let r="navigate";return n>=0?r="back-forward-cache":i&&(document.prerendering||a()>0?r="prerender":document.wasDiscarded?r="restore":i.type&&(r=i.type.replace(/_/g,"-"))),{name:e,value:t,rating:"good",delta:0,entries:[],id:`v5-${Date.now()}-${Math.floor(8999999999999*Math.random())+1e12}`,navigationType:r}},c=new WeakMap;function d(e,t){return c.get(e)||c.set(e,new t),c.get(e)}class h{constructor(){t(this,"t"),t(this,"i",0),t(this,"o",[])}h(e){var t;if(e.hadRecentInput)return;const n=this.o[0],i=this.o.at(-1);this.i&&n&&i&&e.startTime-i.startTime<1e3&&e.startTime-n.startTime<5e3?(this.i+=e.value,this.o.push(e)):(this.i=e.value,this.o=[e]),null==(t=this.t)||t.call(this,e)}}const u=(e,t,n={})=>{try{if(PerformanceObserver.supportedEntryTypes.includes(e)){const i=new PerformanceObserver(e=>{Promise.resolve().then(()=>{t(e.getEntries())})});return i.observe({type:e,buffered:!0,...n}),i}}catch{}},p=e=>{let t=!1;return()=>{t||(e(),t=!0)}};let m=-1;const v=new Set,f=()=>"hidden"!==document.visibilityState||document.prerendering?1/0:0,g=e=>{if("hidden"===document.visibilityState){if("visibilitychange"===e.type)for(const e of v)e();isFinite(m)||(m="visibilitychange"===e.type?e.timeStamp:0,removeEventListener("prerenderingchange",g,!0))}},T=()=>{var e;if(m<0){const t=a(),n=document.prerendering||null==(e=globalThis.performance.getEntriesByType("visibility-state").filter(e=>"hidden"===e.name&&e.startTime>t)[0])?void 0:e.startTime;m=n??f(),addEventListener("visibilitychange",g,!0),addEventListener("prerenderingchange",g,!0),i(()=>{setTimeout(()=>{m=f()})})}return{get firstHiddenTime(){return m},onHidden(e){v.add(e)}}},y=e=>{document.prerendering?addEventListener("prerenderingchange",()=>e(),!0):e()},b=[1800,3e3],P=(e,t={})=>{y(()=>{const n=T();let o,c=l("FCP");const d=u("paint",e=>{for(const t of e)"first-contentful-paint"===t.name&&(d.disconnect(),t.startTime<n.firstHiddenTime&&(c.value=Math.max(t.startTime-a(),0),c.entries.push(t),o(!0)))});d&&(o=r(e,c,b,t.reportAllChanges),i(n=>{c=l("FCP"),o=r(e,c,b,t.reportAllChanges),s(()=>{c.value=performance.now()-n.timeStamp,o(!0)})}))})},C=[.1,.25],L=(e,t={})=>{const n=T();P(p(()=>{let o,a=l("CLS",0);const c=d(t,h),p=e=>{for(const t of e)c.h(t);c.i>a.value&&(a.value=c.i,a.entries=c.o,o())},m=u("layout-shift",p);m&&(o=r(e,a,C,t.reportAllChanges),n.onHidden(()=>{p(m.takeRecords()),o(!0)}),i(()=>{c.i=0,a=l("CLS",0),o=r(e,a,C,t.reportAllChanges),s(()=>o())}),setTimeout(o))}))};let S=0,E=1/0,w=0;const A=e=>{for(const t of e)t.interactionId&&(E=Math.min(E,t.interactionId),w=Math.max(w,t.interactionId),S=w?(w-E)/7+1:0)};let I;const F=()=>I?S:performance.interactionCount??0;let M=0;class k{constructor(){t(this,"u",[]),t(this,"l",new Map),t(this,"m"),t(this,"p")}v(){M=F(),this.u.length=0,this.l.clear()}L(){const e=Math.min(this.u.length-1,Math.floor((F()-M)/50));return this.u[e]}h(e){var t,n;if(null==(t=this.m)||t.call(this,e),!e.interactionId&&"first-input"!==e.entryType)return;const i=this.u.at(-1);let r=this.l.get(e.interactionId);if(r||this.u.length<10||e.duration>i.P){if(r?e.duration>r.P?(r.entries=[e],r.P=e.duration):e.duration===r.P&&e.startTime===r.entries[0].startTime&&r.entries.push(e):(r={id:e.interactionId,entries:[e],P:e.duration},this.l.set(r.id,r),this.u.push(r)),this.u.sort((e,t)=>t.P-e.P),this.u.length>10){const e=this.u.splice(10);for(const t of e)this.l.delete(t.id)}null==(n=this.p)||n.call(this,r)}}}const B=e=>{const t=globalThis.requestIdleCallback||setTimeout;"hidden"===document.visibilityState?e():(e=p(e),addEventListener("visibilitychange",e,{once:!0,capture:!0}),t(()=>{e(),removeEventListener("visibilitychange",e,{capture:!0})}))},H=[200,500],x=(e,t={})=>{if(!globalThis.PerformanceEventTiming||!("interactionId"in PerformanceEventTiming.prototype))return;const n=T();y(()=>{"interactionCount"in performance||I||(I=u("event",A,{type:"event",buffered:!0,durationThreshold:0}));let s,o=l("INP");const a=d(t,k),c=e=>{B(()=>{for(const n of e)a.h(n);const t=a.L();t&&t.P!==o.value&&(o.value=t.P,o.entries=t.entries,s())})},h=u("event",c,{durationThreshold:t.durationThreshold??40});s=r(e,o,H,t.reportAllChanges),h&&(h.observe({type:"first-input",buffered:!0}),n.onHidden(()=>{c(h.takeRecords()),s(!0)}),i(()=>{a.v(),o=l("INP"),s=r(e,o,H,t.reportAllChanges)}))})};class N{constructor(){t(this,"m")}h(e){var t;null==(t=this.m)||t.call(this,e)}}const R=[2500,4e3],q=(e,t={})=>{y(()=>{const n=T();let o,c=l("LCP");const h=d(t,N),m=e=>{t.reportAllChanges||(e=e.slice(-1));for(const t of e)h.h(t),t.startTime<n.firstHiddenTime&&(c.value=Math.max(t.startTime-a(),0),c.entries=[t],o())},v=u("largest-contentful-paint",m);if(v){o=r(e,c,R,t.reportAllChanges);const n=p(()=>{m(v.takeRecords()),v.disconnect(),o(!0)}),a=e=>{e.isTrusted&&(B(n),removeEventListener(e.type,a,{capture:!0}))};for(const e of["keydown","click","visibilitychange"])addEventListener(e,a,{capture:!0});i(n=>{c=l("LCP"),o=r(e,c,R,t.reportAllChanges),s(()=>{c.value=performance.now()-n.timeStamp,o(!0)})})}})},O=[800,1800],D=e=>{document.prerendering?y(()=>D(e)):"complete"!==document.readyState?addEventListener("load",()=>D(e),!0):setTimeout(e)},$=(e,t={})=>{let n=l("TTFB"),s=r(e,n,O,t.reportAllChanges);D(()=>{const c=o();c&&(n.value=Math.max(c.responseStart-a(),0),n.entries=[c],s(!0),i(()=>{n=l("TTFB",0),s=r(e,n,O,t.reportAllChanges),s(!0)}))})};export{C as CLSThresholds,b as FCPThresholds,H as INPThresholds,R as LCPThresholds,O as TTFBThresholds,L as onCLS,P as onFCP,x as onINP,q as onLCP,$ as onTTFB};
