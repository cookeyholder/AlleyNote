import{r as t,b as e}from"./DashboardLayout-BjmJ-OJc.js";import{p as n}from"./posts-D8uqMnbu.js";import{t as s}from"./toast-ChPGQGGG.js";import{c as o}from"./ConfirmationDialog-DKaQBUc8.js";import{l as a}from"./Loading-D3hznI52.js";import{r as d}from"./index-DHmEDfox.js";import"./vendor-core-DW9qjkZC.js";let i=1,r={},l={posts:[]};async function c(){var n,s,o;document.getElementById("app").innerHTML=t('\n    <div>\n      <div class="flex items-center justify-between mb-8">\n        <h1 class="text-3xl font-bold text-modern-900">文章管理</h1>\n        <a href="/admin/posts/create" data-navigo class="btn-primary">\n          ✏️ 新增文章\n        </a>\n      </div>\n      \n      \x3c!-- 搜尋與篩選 --\x3e\n      <div class="card mb-6">\n        <div class="flex flex-col md:flex-row gap-4">\n          <input\n            type="text"\n            id="search-input"\n            placeholder="搜尋文章標題..."\n            class="input-field flex-1"\n          />\n          <select id="status-filter" class="input-field md:w-48">\n            <option value="">所有狀態</option>\n            <option value="published">已發布</option>\n            <option value="draft">草稿</option>\n          </select>\n          <select id="sort-filter" class="input-field md:w-48">\n            <option value="-created_at">最新優先</option>\n            <option value="created_at">最舊優先</option>\n            <option value="title">標題 A-Z</option>\n            <option value="-title">標題 Z-A</option>\n          </select>\n          <button id="search-btn" class="btn-primary md:w-auto">搜尋</button>\n          <button id="reset-btn" class="btn-secondary md:w-auto">重置</button>\n        </div>\n      </div>\n      \n      \x3c!-- 文章列表 --\x3e\n      <div class="card">\n        <div id="posts-table-container">\n          <div class="text-center py-8">\n            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-accent-600 mx-auto"></div>\n            <p class="mt-4 text-modern-600">載入中...</p>\n          </div>\n        </div>\n      </div>\n    </div>\n  '),e(),await p(),null==(n=document.getElementById("search-btn"))||n.addEventListener("click",()=>{i=1,p()}),null==(s=document.getElementById("reset-btn"))||s.addEventListener("click",()=>{document.getElementById("search-input").value="",document.getElementById("status-filter").value="",document.getElementById("sort-filter").value="-created_at",i=1,r={},p()}),null==(o=document.getElementById("search-input"))||o.addEventListener("keypress",t=>{"Enter"===t.key&&(i=1,p())})}async function p(){var t,e,s;const o=document.getElementById("posts-table-container"),c=(null==(t=document.getElementById("search-input"))?void 0:t.value)||"",p=(null==(e=document.getElementById("status-filter"))?void 0:e.value)||"",u=(null==(s=document.getElementById("sort-filter"))?void 0:s.value)||"-created_at";a.show("載入中...");try{r={search:c,status:p,sort:u,page:i,per_page:10};const t=await n.list(r),e=t.data||[],s=t.pagination||{};if(l.posts=e,a.hide(),0===e.length)return o.innerHTML=`\n        <div class="text-center py-12">\n          <div class="text-6xl mb-4">📝</div>\n          <p class="text-modern-600 mb-4">\n            ${c||p?"找不到符合條件的文章":"目前沒有文章"}\n          </p>\n          ${c||p?"":'\n            <a href="/admin/posts/create" data-navigo class="btn-primary inline-block">新增第一篇文章</a>\n          '}\n        </div>\n      `,void d.updatePageLinks();o.innerHTML=`\n      <table class="w-full">\n        <thead class="bg-modern-50">\n          <tr>\n            <th class="px-6 py-3 text-left text-xs font-medium text-modern-500 uppercase tracking-wider">標題</th>\n            <th class="px-6 py-3 text-left text-xs font-medium text-modern-500 uppercase tracking-wider">狀態</th>\n            <th class="px-6 py-3 text-left text-xs font-medium text-modern-500 uppercase tracking-wider">作者</th>\n            <th class="px-6 py-3 text-left text-xs font-medium text-modern-500 uppercase tracking-wider">建立時間</th>\n            <th class="px-6 py-3 text-right text-xs font-medium text-modern-500 uppercase tracking-wider">操作</th>\n          </tr>\n        </thead>\n        <tbody class="bg-white divide-y divide-modern-200">\n          ${e.map(t=>`\n            <tr class="hover:bg-modern-50">\n              <td class="px-6 py-4">\n                <div class="text-sm font-medium text-modern-900">${t.title}</div>\n              </td>\n              <td class="px-6 py-4">\n                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${"published"===t.status?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}">\n                  ${"published"===t.status?"已發布":"草稿"}\n                </span>\n              </td>\n              <td class="px-6 py-4 text-sm text-modern-600">${t.author||"Unknown"}</td>\n              <td class="px-6 py-4 text-sm text-modern-600">${new Date(t.created_at).toLocaleDateString("zh-TW")}</td>\n              <td class="px-6 py-4 text-right text-sm">\n                <div class="flex justify-end gap-2">\n                  <a href="/admin/posts/${t.id}/edit" data-navigo class="px-3 py-1 text-accent-600 hover:bg-accent-50 rounded transition-colors">\n                    編輯\n                  </a>\n                  <button \n                    onclick="window.togglePostStatus(${t.id}, '${t.status}')" \n                    class="px-3 py-1 text-blue-600 hover:bg-blue-50 rounded transition-colors"\n                  >\n                    ${"published"===t.status?"轉草稿":"發布"}\n                  </button>\n                  <button \n                    onclick="window.deletePost(${t.id})" \n                    class="px-3 py-1 text-red-600 hover:bg-red-50 rounded transition-colors"\n                  >\n                    刪除\n                  </button>\n                </div>\n              </td>\n            </tr>\n          `).join("")}\n        </tbody>\n      </table>\n      \n      \x3c!-- 分頁 --\x3e\n      ${function(t){if(!t||t.total_pages<=1)return"";const{page:e,total_pages:n}=t,s=[];for(let o=1;o<=n;o++)1===o||o===n||o>=e-2&&o<=e+2?s.push(o):"..."!==s[s.length-1]&&s.push("...");return`\n    <div class="flex items-center justify-between px-6 py-4 border-t border-modern-200">\n      <div class="text-sm text-modern-600">\n        第 ${e} 頁，共 ${n} 頁\n      </div>\n      <div class="flex gap-2">\n        <button \n          onclick="window.goToPage(${e-1})"\n          ${1===e?"disabled":""}\n          class="px-3 py-1 border border-modern-300 rounded hover:bg-modern-50 disabled:opacity-50 disabled:cursor-not-allowed"\n        >\n          上一頁\n        </button>\n        ${s.map(t=>"..."===t?'<span class="px-3 py-1">...</span>':`\n            <button \n              onclick="window.goToPage(${t})"\n              class="px-3 py-1 border border-modern-300 rounded hover:bg-modern-50 ${t===e?"bg-accent-600 text-white border-accent-600":""}"\n            >\n              ${t}\n            </button>\n          `).join("")}\n        <button \n          onclick="window.goToPage(${e+1})"\n          ${e===n?"disabled":""}\n          class="px-3 py-1 border border-modern-300 rounded hover:bg-modern-50 disabled:opacity-50 disabled:cursor-not-allowed"\n        >\n          下一頁\n        </button>\n      </div>\n    </div>\n  `}(s)}\n    `,d.updatePageLinks()}catch(m){a.hide(),o.innerHTML=`\n      <div class="text-center py-12">\n        <div class="text-6xl mb-4">⚠️</div>\n        <p class="text-red-600 mb-4">載入失敗：${m.message}</p>\n        <button onclick="location.reload()" class="btn-primary">重試</button>\n      </div>\n    `}}window.deletePost=async function(t){const e=l.posts.find(e=>e.id===t);if(await o((null==e?void 0:e.title)||"此文章")){a.show("刪除中...");try{await n.delete(t),a.hide(),s.success("文章已刪除"),await p()}catch(d){a.hide(),s.error("刪除失敗："+d.message)}}},window.togglePostStatus=async function(t,e){const o="published"===e?"draft":"published",d="published"===o?"發布":"轉為草稿";a.show(`${d}中...`);try{await n.update(t,{status:o}),a.hide(),s.success(`文章已${d}`),await p()}catch(i){a.hide(),s.error(`${d}失敗：`+i.message)}},window.goToPage=function(t){i=t,p()};export{c as renderPostsList};
