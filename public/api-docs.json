{
    "openapi": "3.0.0",
    "info": {
        "title": "AlleyNote API",
        "description": "AlleyNote 公布欄系統 API 文件",
        "version": "1.0.0"
    },
    "paths": {
        "/posts/{post_id}/attachments": {
            "get": {
                "tags": [
                    "attachments"
                ],
                "summary": "取得貼文附件列表",
                "description": "取得指定貼文的所有附件檔案清單",
                "operationId": "listAttachments",
                "parameters": [
                    {
                        "name": "post_id",
                        "in": "path",
                        "description": "貼文 ID",
                        "required": true,
                        "schema": {
                            "type": "integer",
                            "minimum": 1
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "成功取得附件列表",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "data": {
                                            "type": "array",
                                            "items": {
                                                "properties": {
                                                    "id": {
                                                        "type": "string",
                                                        "example": "550e8400-e29b-41d4-a716-446655440000"
                                                    },
                                                    "post_id": {
                                                        "type": "integer",
                                                        "example": 1
                                                    },
                                                    "filename": {
                                                        "type": "string",
                                                        "example": "document.pdf"
                                                    },
                                                    "original_name": {
                                                        "type": "string",
                                                        "example": "重要文件.pdf"
                                                    },
                                                    "file_size": {
                                                        "description": "檔案大小（位元組）",
                                                        "type": "integer",
                                                        "example": 1024000
                                                    },
                                                    "mime_type": {
                                                        "type": "string",
                                                        "example": "application/pdf"
                                                    },
                                                    "download_url": {
                                                        "type": "string",
                                                        "example": "/api/attachments/550e8400-e29b-41d4-a716-446655440000/download"
                                                    },
                                                    "uploaded_by": {
                                                        "type": "integer",
                                                        "example": 1
                                                    },
                                                    "created_at": {
                                                        "type": "string",
                                                        "format": "date-time",
                                                        "example": "2025-01-15T10:30:00Z"
                                                    }
                                                },
                                                "type": "object"
                                            }
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "貼文不存在",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/responses/NotFound"
                                }
                            }
                        }
                    }
                }
            },
            "post": {
                "tags": [
                    "attachments"
                ],
                "summary": "上傳文件附件",
                "description": "為指定貼文上傳附件檔案，支援多種檔案格式",
                "operationId": "uploadAttachment",
                "parameters": [
                    {
                        "name": "post_id",
                        "in": "path",
                        "description": "貼文 ID",
                        "required": true,
                        "schema": {
                            "type": "integer",
                            "minimum": 1
                        }
                    }
                ],
                "requestBody": {
                    "description": "上傳的檔案",
                    "required": true,
                    "content": {
                        "multipart/form-data": {
                            "schema": {
                                "required": [
                                    "file"
                                ],
                                "properties": {
                                    "file": {
                                        "description": "要上傳的檔案",
                                        "type": "string",
                                        "format": "binary"
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "201": {
                        "description": "檔案上傳成功",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "success": {
                                            "type": "boolean",
                                            "example": true
                                        },
                                        "message": {
                                            "type": "string",
                                            "example": "檔案上傳成功"
                                        },
                                        "data": {
                                            "properties": {
                                                "id": {
                                                    "type": "string",
                                                    "example": "550e8400-e29b-41d4-a716-446655440000"
                                                },
                                                "post_id": {
                                                    "type": "integer",
                                                    "example": 1
                                                },
                                                "filename": {
                                                    "type": "string",
                                                    "example": "document.pdf"
                                                },
                                                "original_name": {
                                                    "type": "string",
                                                    "example": "重要文件.pdf"
                                                },
                                                "file_size": {
                                                    "description": "檔案大小（位元組）",
                                                    "type": "integer",
                                                    "example": 1024000
                                                },
                                                "mime_type": {
                                                    "type": "string",
                                                    "example": "application/pdf"
                                                },
                                                "download_url": {
                                                    "type": "string",
                                                    "example": "/api/attachments/550e8400-e29b-41d4-a716-446655440000/download"
                                                },
                                                "uploaded_by": {
                                                    "type": "integer",
                                                    "example": 1
                                                },
                                                "created_at": {
                                                    "type": "string",
                                                    "format": "date-time",
                                                    "example": "2025-01-15T10:30:00Z"
                                                }
                                            },
                                            "type": "object"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "檔案上傳失敗或格式不支援",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "error": {
                                            "type": "string",
                                            "example": "不支援的檔案格式"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "未授權存取",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/responses/Unauthorized"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "貼文不存在",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/responses/NotFound"
                                }
                            }
                        }
                    },
                    "413": {
                        "description": "檔案大小超過限制",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "error": {
                                            "type": "string",
                                            "example": "檔案大小超過 10MB 限制"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    }
                },
                "security": [
                    {
                        "bearerAuth": []
                    },
                    {
                        "sessionAuth": []
                    }
                ]
            }
        },
        "/attachments/{id}/download": {
            "get": {
                "tags": [
                    "attachments"
                ],
                "summary": "下載附件",
                "description": "下載指定的附件檔案",
                "operationId": "downloadAttachment",
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "description": "附件 UUID",
                        "required": true,
                        "schema": {
                            "type": "string",
                            "format": "uuid"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "檔案下載成功",
                        "headers": {
                            "Content-Disposition": {
                                "description": "檔案下載標頭",
                                "schema": {
                                    "type": "string",
                                    "example": "attachment; filename=\"document.pdf\""
                                }
                            },
                            "Content-Type": {
                                "description": "檔案 MIME 類型",
                                "schema": {
                                    "type": "string",
                                    "example": "application/pdf"
                                }
                            },
                            "Content-Length": {
                                "description": "檔案大小",
                                "schema": {
                                    "type": "integer",
                                    "example": 1024000
                                }
                            }
                        },
                        "content": {
                            "application/octet-stream": {
                                "schema": {
                                    "type": "string",
                                    "format": "binary"
                                }
                            },
                            "*/*": {
                                "schema": {
                                    "type": "string",
                                    "format": "binary"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "無效的附件識別碼",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "error": {
                                            "type": "string",
                                            "example": "無效的附件識別碼"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "附件不存在",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/responses/NotFound"
                                }
                            }
                        }
                    },
                    "410": {
                        "description": "檔案已不存在",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "error": {
                                            "type": "string",
                                            "example": "檔案已被刪除或移動"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/attachments/{id}": {
            "delete": {
                "tags": [
                    "attachments"
                ],
                "summary": "刪除附件",
                "description": "刪除指定的附件檔案，只有上傳者或管理員可以刪除",
                "operationId": "deleteAttachment",
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "description": "附件 UUID",
                        "required": true,
                        "schema": {
                            "type": "string",
                            "format": "uuid"
                        }
                    }
                ],
                "responses": {
                    "204": {
                        "description": "附件刪除成功"
                    },
                    "400": {
                        "description": "無效的附件識別碼",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "error": {
                                            "type": "string",
                                            "example": "無效的附件識別碼"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "未授權存取",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/responses/Unauthorized"
                                }
                            }
                        }
                    },
                    "403": {
                        "description": "無權限刪除此附件",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "error": {
                                            "type": "string",
                                            "example": "您沒有權限刪除此附件"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "附件不存在",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/responses/NotFound"
                                }
                            }
                        }
                    }
                },
                "security": [
                    {
                        "bearerAuth": []
                    },
                    {
                        "sessionAuth": []
                    }
                ]
            }
        },
        "/auth/register": {
            "post": {
                "tags": [
                    "auth"
                ],
                "summary": "使用者註冊",
                "description": "建立新的使用者帳號，需要提供使用者名稱、電子郵件和密碼",
                "operationId": "registerUser",
                "requestBody": {
                    "description": "註冊資料",
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "required": [
                                    "username",
                                    "email",
                                    "password",
                                    "password_confirmation"
                                ],
                                "properties": {
                                    "username": {
                                        "description": "使用者名稱",
                                        "type": "string",
                                        "maxLength": 50,
                                        "minLength": 3,
                                        "example": "johndoe"
                                    },
                                    "email": {
                                        "description": "電子郵件地址",
                                        "type": "string",
                                        "format": "email",
                                        "example": "john@example.com"
                                    },
                                    "password": {
                                        "description": "密碼，至少8個字元",
                                        "type": "string",
                                        "format": "password",
                                        "minLength": 8,
                                        "example": "password123"
                                    },
                                    "password_confirmation": {
                                        "description": "確認密碼，必須與密碼相同",
                                        "type": "string",
                                        "format": "password",
                                        "example": "password123"
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "201": {
                        "description": "註冊成功",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "success": {
                                            "type": "boolean",
                                            "example": true
                                        },
                                        "message": {
                                            "type": "string",
                                            "example": "註冊成功"
                                        },
                                        "data": {
                                            "properties": {
                                                "id": {
                                                    "type": "integer",
                                                    "example": 1
                                                },
                                                "username": {
                                                    "type": "string",
                                                    "example": "johndoe"
                                                },
                                                "email": {
                                                    "type": "string",
                                                    "example": "john@example.com"
                                                },
                                                "role": {
                                                    "type": "string",
                                                    "example": "user"
                                                },
                                                "created_at": {
                                                    "type": "string",
                                                    "format": "date-time",
                                                    "example": "2025-01-15T10:30:00Z"
                                                }
                                            },
                                            "type": "object"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "註冊資料驗證失敗",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "success": {
                                            "type": "boolean",
                                            "example": false
                                        },
                                        "error": {
                                            "type": "string",
                                            "example": "資料驗證失敗"
                                        },
                                        "errors": {
                                            "type": "object",
                                            "example": {
                                                "username": [
                                                    "使用者名稱已存在"
                                                ],
                                                "email": [
                                                    "電子郵件格式不正確"
                                                ],
                                                "password": [
                                                    "密碼長度不足8個字元"
                                                ]
                                            },
                                            "additionalProperties": {
                                                "type": "array",
                                                "items": {
                                                    "type": "string"
                                                }
                                            }
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "409": {
                        "description": "使用者名稱或電子郵件已存在",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "success": {
                                            "type": "boolean",
                                            "example": false
                                        },
                                        "error": {
                                            "type": "string",
                                            "example": "使用者名稱或電子郵件已存在"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "伺服器內部錯誤",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "success": {
                                            "type": "boolean",
                                            "example": false
                                        },
                                        "error": {
                                            "type": "string",
                                            "example": "系統發生錯誤"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/auth/login": {
            "post": {
                "tags": [
                    "auth"
                ],
                "summary": "使用者登入",
                "description": "使用帳號密碼或電子郵件密碼進行登入驗證",
                "operationId": "loginUser",
                "requestBody": {
                    "description": "登入憑證",
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/LoginRequest"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "登入成功",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/LoginResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "登入資料格式錯誤",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "success": {
                                            "type": "boolean",
                                            "example": false
                                        },
                                        "error": {
                                            "type": "string",
                                            "example": "缺少必要的登入資料"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "登入失敗",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "success": {
                                            "type": "boolean",
                                            "example": false
                                        },
                                        "error": {
                                            "type": "string",
                                            "example": "使用者名稱或密碼錯誤"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "423": {
                        "description": "帳號被鎖定",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "success": {
                                            "type": "boolean",
                                            "example": false
                                        },
                                        "error": {
                                            "type": "string",
                                            "example": "帳號暫時被鎖定，請稍後再試"
                                        },
                                        "retry_after": {
                                            "description": "解鎖剩餘秒數",
                                            "type": "integer",
                                            "example": 300
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "伺服器內部錯誤",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "success": {
                                            "type": "boolean",
                                            "example": false
                                        },
                                        "error": {
                                            "type": "string",
                                            "example": "系統發生錯誤"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/auth/logout": {
            "post": {
                "tags": [
                    "auth"
                ],
                "summary": "使用者登出",
                "description": "登出當前使用者，清除認證狀態和會話",
                "operationId": "logoutUser",
                "responses": {
                    "200": {
                        "description": "登出成功",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "success": {
                                            "type": "boolean",
                                            "example": true
                                        },
                                        "message": {
                                            "type": "string",
                                            "example": "登出成功"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "未授權存取或 Token 無效",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/responses/Unauthorized"
                                }
                            }
                        }
                    }
                },
                "security": [
                    {
                        "bearerAuth": []
                    },
                    {
                        "sessionAuth": []
                    }
                ]
            }
        },
        "/auth/me": {
            "get": {
                "tags": [
                    "auth"
                ],
                "summary": "取得當前使用者資訊",
                "description": "取得目前登入使用者的詳細資訊",
                "operationId": "getCurrentUser",
                "responses": {
                    "200": {
                        "description": "成功取得使用者資訊",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "success": {
                                            "type": "boolean",
                                            "example": true
                                        },
                                        "data": {
                                            "$ref": "#/components/schemas/User"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "未授權存取或 Token 無效",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/responses/Unauthorized"
                                }
                            }
                        }
                    }
                },
                "security": [
                    {
                        "bearerAuth": []
                    },
                    {
                        "sessionAuth": []
                    }
                ]
            }
        },
        "/auth/refresh": {
            "post": {
                "tags": [
                    "auth"
                ],
                "summary": "刷新認證 Token",
                "description": "使用 Refresh Token 取得新的 Access Token",
                "operationId": "refreshToken",
                "requestBody": {
                    "description": "Refresh Token",
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "required": [
                                    "refresh_token"
                                ],
                                "properties": {
                                    "refresh_token": {
                                        "description": "有效的 Refresh Token",
                                        "type": "string",
                                        "example": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9..."
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Token 刷新成功",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "success": {
                                            "type": "boolean",
                                            "example": true
                                        },
                                        "message": {
                                            "type": "string",
                                            "example": "Token 刷新成功"
                                        },
                                        "access_token": {
                                            "type": "string",
                                            "example": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9..."
                                        },
                                        "token_type": {
                                            "type": "string",
                                            "example": "Bearer"
                                        },
                                        "expires_in": {
                                            "description": "Token 有效期（秒）",
                                            "type": "integer",
                                            "example": 3600
                                        },
                                        "expires_at": {
                                            "type": "string",
                                            "format": "date-time",
                                            "example": "2025-01-15T11:30:00Z"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "缺少或格式錯誤的 Refresh Token",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "success": {
                                            "type": "boolean",
                                            "example": false
                                        },
                                        "error": {
                                            "type": "string",
                                            "example": "無效的 refresh_token 格式"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Refresh Token 無效或已過期",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "success": {
                                            "type": "boolean",
                                            "example": false
                                        },
                                        "error": {
                                            "type": "string",
                                            "example": "Refresh token 無效或已過期"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/posts": {
            "get": {
                "tags": [
                    "posts"
                ],
                "summary": "取得所有貼文",
                "description": "取得分頁的貼文列表，支援搜尋和篩選",
                "operationId": "getPosts",
                "parameters": [
                    {
                        "name": "page",
                        "in": "query",
                        "description": "頁碼",
                        "required": false,
                        "schema": {
                            "type": "integer",
                            "default": 1,
                            "minimum": 1
                        }
                    },
                    {
                        "name": "limit",
                        "in": "query",
                        "description": "每頁筆數",
                        "required": false,
                        "schema": {
                            "type": "integer",
                            "default": 10,
                            "maximum": 100,
                            "minimum": 1
                        }
                    },
                    {
                        "name": "search",
                        "in": "query",
                        "description": "搜尋關鍵字",
                        "required": false,
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "name": "category",
                        "in": "query",
                        "description": "貼文分類篩選",
                        "required": false,
                        "schema": {
                            "type": "string",
                            "enum": [
                                "general",
                                "announcement",
                                "urgent",
                                "notice"
                            ]
                        }
                    },
                    {
                        "name": "status",
                        "in": "query",
                        "description": "貼文狀態篩選",
                        "required": false,
                        "schema": {
                            "type": "string",
                            "enum": [
                                "draft",
                                "published",
                                "archived"
                            ]
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "成功取得貼文列表",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/PaginatedResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "請求參數錯誤",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ValidationError"
                                }
                            }
                        }
                    }
                }
            },
            "post": {
                "tags": [
                    "posts"
                ],
                "summary": "建立新貼文",
                "description": "建立一篇新的貼文，需要 CSRF Token 驗證",
                "operationId": "createPost",
                "requestBody": {
                    "description": "貼文資料",
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/CreatePostRequest"
                            }
                        }
                    }
                },
                "responses": {
                    "201": {
                        "description": "貼文建立成功",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ApiResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "輸入資料驗證失敗",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ValidationError"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "未授權存取",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/responses/Unauthorized"
                                }
                            }
                        }
                    },
                    "403": {
                        "description": "CSRF Token 驗證失敗",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "error": {
                                            "type": "string",
                                            "example": "CSRF token verification failed"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    }
                },
                "security": [
                    {
                        "csrfToken": []
                    }
                ]
            }
        },
        "/posts/{id}": {
            "get": {
                "tags": [
                    "posts"
                ],
                "summary": "取得單一貼文",
                "description": "根據 ID 取得貼文詳細資訊，並記錄瀏覽次數",
                "operationId": "getPostById",
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "description": "貼文 ID",
                        "required": true,
                        "schema": {
                            "type": "integer",
                            "minimum": 1
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "成功取得貼文詳細資訊",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "data": {
                                            "$ref": "#/components/schemas/Post"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "貼文不存在",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/responses/NotFound"
                                }
                            }
                        }
                    }
                }
            },
            "put": {
                "tags": [
                    "posts"
                ],
                "summary": "更新貼文",
                "description": "更新指定 ID 的貼文，需要 CSRF Token 驗證",
                "operationId": "updatePost",
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "description": "貼文 ID",
                        "required": true,
                        "schema": {
                            "type": "integer",
                            "minimum": 1
                        }
                    }
                ],
                "requestBody": {
                    "description": "更新的貼文資料",
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/UpdatePostRequest"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "貼文更新成功",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ApiResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "輸入資料驗證失敗",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ValidationError"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "未授權存取",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/responses/Unauthorized"
                                }
                            }
                        }
                    },
                    "403": {
                        "description": "CSRF Token 驗證失敗",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "error": {
                                            "type": "string",
                                            "example": "CSRF token verification failed"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "貼文不存在",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/responses/NotFound"
                                }
                            }
                        }
                    }
                },
                "security": [
                    {
                        "csrfToken": []
                    }
                ]
            },
            "delete": {
                "tags": [
                    "posts"
                ],
                "summary": "刪除貼文",
                "description": "刪除指定 ID 的貼文，需要 CSRF Token 驗證",
                "operationId": "deletePost",
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "description": "貼文 ID",
                        "required": true,
                        "schema": {
                            "type": "integer",
                            "minimum": 1
                        }
                    }
                ],
                "responses": {
                    "204": {
                        "description": "貼文刪除成功"
                    },
                    "401": {
                        "description": "未授權存取",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/responses/Unauthorized"
                                }
                            }
                        }
                    },
                    "403": {
                        "description": "CSRF Token 驗證失敗",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "error": {
                                            "type": "string",
                                            "example": "CSRF token verification failed"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "貼文不存在",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/responses/NotFound"
                                }
                            }
                        }
                    }
                },
                "security": [
                    {
                        "csrfToken": []
                    }
                ]
            }
        },
        "/posts/{id}/pin": {
            "patch": {
                "tags": [
                    "posts"
                ],
                "summary": "更新貼文置頂狀態",
                "description": "設定或取消貼文的置頂狀態，需要 CSRF Token 驗證",
                "operationId": "togglePostPin",
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "description": "貼文 ID",
                        "required": true,
                        "schema": {
                            "type": "integer",
                            "minimum": 1
                        }
                    }
                ],
                "requestBody": {
                    "description": "置頂狀態",
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "properties": {
                                    "pinned": {
                                        "description": "是否置頂",
                                        "type": "boolean",
                                        "example": true
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "置頂狀態更新成功",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "success": {
                                            "type": "boolean",
                                            "example": true
                                        },
                                        "message": {
                                            "type": "string",
                                            "example": "置頂狀態已更新"
                                        },
                                        "data": {
                                            "$ref": "#/components/schemas/Post"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "請求資料格式錯誤",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ValidationError"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "未授權存取",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/responses/Unauthorized"
                                }
                            }
                        }
                    },
                    "403": {
                        "description": "CSRF Token 驗證失敗",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "error": {
                                            "type": "string",
                                            "example": "CSRF token verification failed"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "貼文不存在",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/responses/NotFound"
                                }
                            }
                        }
                    }
                },
                "security": [
                    {
                        "csrfToken": []
                    }
                ]
            }
        },
        "/health": {
            "get": {
                "tags": [
                    "health"
                ],
                "summary": "健康檢查端點",
                "operationId": "158a1389adf0d693d528c07a8f30136f",
                "responses": {
                    "200": {
                        "description": "系統正常運行"
                    }
                }
            }
        }
    },
    "components": {
        "schemas": {
            "User": {
                "title": "使用者",
                "description": "使用者資料結構",
                "properties": {
                    "id": {
                        "description": "使用者ID",
                        "type": "integer",
                        "example": 1
                    },
                    "username": {
                        "description": "使用者名稱",
                        "type": "string",
                        "example": "admin"
                    },
                    "email": {
                        "description": "電子郵件",
                        "type": "string",
                        "format": "email",
                        "example": "admin@example.com"
                    },
                    "role": {
                        "description": "使用者角色",
                        "type": "string",
                        "enum": [
                            "admin",
                            "moderator",
                            "user"
                        ],
                        "example": "admin"
                    },
                    "created_at": {
                        "description": "建立時間",
                        "type": "string",
                        "format": "date-time",
                        "example": "2025-01-15T10:30:00Z"
                    }
                },
                "type": "object"
            },
            "LoginRequest": {
                "title": "登入請求",
                "description": "使用者登入請求",
                "required": [
                    "username",
                    "password"
                ],
                "properties": {
                    "username": {
                        "description": "使用者名稱",
                        "type": "string",
                        "example": "admin"
                    },
                    "password": {
                        "description": "密碼",
                        "type": "string",
                        "format": "password",
                        "example": "password123"
                    },
                    "remember_me": {
                        "description": "記住我",
                        "type": "boolean",
                        "default": false,
                        "example": false
                    }
                },
                "type": "object"
            },
            "LoginResponse": {
                "title": "登入回應",
                "description": "登入成功回應",
                "properties": {
                    "success": {
                        "description": "登入是否成功",
                        "type": "boolean",
                        "example": true
                    },
                    "message": {
                        "description": "回應訊息",
                        "type": "string",
                        "example": "登入成功"
                    },
                    "token": {
                        "description": "JWT Token",
                        "type": "string",
                        "example": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9..."
                    },
                    "user": {
                        "$ref": "#/components/schemas/User"
                    },
                    "expires_at": {
                        "description": "Token 過期時間",
                        "type": "string",
                        "format": "date-time",
                        "example": "2025-01-16T10:30:00Z"
                    }
                },
                "type": "object"
            },
            "CreatePostRequest": {
                "title": "建立貼文請求",
                "description": "建立新貼文的請求資料結構，包含標題、內容、分類等必要資訊",
                "required": [
                    "title",
                    "content"
                ],
                "properties": {
                    "title": {
                        "description": "貼文標題，用於簡要描述貼文主題",
                        "type": "string",
                        "maxLength": 255,
                        "minLength": 1,
                        "example": "系統維護通知 - 2025年1月20日"
                    },
                    "content": {
                        "description": "貼文內容，支援 Markdown 格式",
                        "type": "string",
                        "maxLength": 10000,
                        "minLength": 1,
                        "example": "親愛的使用者，\n\n系統將於 **2025年1月20日 02:00-04:00** 進行維護，期間服務可能暫時中斷。\n\n維護內容：\n- 資料庫效能優化\n- 安全性更新\n- 新功能部署\n\n造成不便敬請見諒。\n\n---\n技術團隊"
                    },
                    "category": {
                        "description": "貼文分類，用於組織和篩選貼文",
                        "type": "string",
                        "default": "general",
                        "enum": [
                            "general",
                            "announcement",
                            "urgent",
                            "notice"
                        ],
                        "example": "announcement"
                    },
                    "priority": {
                        "description": "優先級，影響貼文在列表中的排序和顯示樣式",
                        "type": "string",
                        "default": "normal",
                        "enum": [
                            "low",
                            "normal",
                            "high",
                            "urgent"
                        ],
                        "example": "high"
                    },
                    "expires_at": {
                        "description": "過期時間（ISO 8601 格式），過期後貼文將自動隱藏",
                        "type": "string",
                        "format": "date-time",
                        "example": "2025-12-31T23:59:59+08:00",
                        "nullable": true
                    },
                    "tags": {
                        "description": "標籤列表，用於標記和搜尋",
                        "type": "array",
                        "items": {
                            "type": "string",
                            "maxLength": 50
                        },
                        "maxItems": 10,
                        "example": [
                            "維護",
                            "系統更新",
                            "重要通知"
                        ]
                    },
                    "is_pinned": {
                        "description": "是否置頂顯示",
                        "type": "boolean",
                        "default": false,
                        "example": true
                    },
                    "allow_comments": {
                        "description": "是否允許留言",
                        "type": "boolean",
                        "default": true,
                        "example": false
                    }
                },
                "type": "object",
                "example": {
                    "title": "系統維護通知 - 2025年1月20日",
                    "content": "親愛的使用者，\n\n系統將於 **2025年1月20日 02:00-04:00** 進行維護...",
                    "category": "announcement",
                    "priority": "high",
                    "expires_at": "2025-12-31T23:59:59+08:00",
                    "tags": [
                        "維護",
                        "系統更新",
                        "重要通知"
                    ],
                    "is_pinned": true,
                    "allow_comments": false
                }
            },
            "UpdatePostRequest": {
                "title": "更新貼文請求",
                "description": "更新既有貼文的請求資料，所有欄位皆為可選，僅更新提供的欄位",
                "properties": {
                    "title": {
                        "description": "更新貼文標題",
                        "type": "string",
                        "maxLength": 255,
                        "minLength": 1,
                        "example": "【更新】系統維護延期通知"
                    },
                    "content": {
                        "description": "更新貼文內容",
                        "type": "string",
                        "maxLength": 10000,
                        "minLength": 1,
                        "example": "**重要更新**\n\n原定於 2025年1月20日 的系統維護將延期至 **2025年1月25日**。\n\n詳細資訊請參考最新公告。"
                    },
                    "category": {
                        "description": "更新貼文分類",
                        "type": "string",
                        "enum": [
                            "general",
                            "announcement",
                            "urgent",
                            "notice"
                        ],
                        "example": "urgent"
                    },
                    "status": {
                        "description": "更新貼文狀態",
                        "type": "string",
                        "enum": [
                            "draft",
                            "published",
                            "archived"
                        ],
                        "example": "published"
                    },
                    "priority": {
                        "description": "更新優先級",
                        "type": "string",
                        "enum": [
                            "low",
                            "normal",
                            "high",
                            "urgent"
                        ],
                        "example": "urgent"
                    },
                    "expires_at": {
                        "description": "更新過期時間",
                        "type": "string",
                        "format": "date-time",
                        "example": "2025-02-28T23:59:59+08:00",
                        "nullable": true
                    },
                    "tags": {
                        "description": "更新標籤列表",
                        "type": "array",
                        "items": {
                            "type": "string",
                            "maxLength": 50
                        },
                        "maxItems": 10,
                        "example": [
                            "維護延期",
                            "重要更新",
                            "緊急通知"
                        ]
                    },
                    "is_pinned": {
                        "description": "更新置頂狀態",
                        "type": "boolean",
                        "example": true
                    },
                    "allow_comments": {
                        "description": "更新留言允許狀態",
                        "type": "boolean",
                        "example": true
                    }
                },
                "type": "object",
                "example": {
                    "title": "【更新】系統維護延期通知",
                    "content": "**重要更新**\n\n原定於 2025年1月20日 的系統維護將延期...",
                    "category": "urgent",
                    "status": "published",
                    "priority": "urgent",
                    "expires_at": "2025-02-28T23:59:59+08:00",
                    "tags": [
                        "維護延期",
                        "重要更新",
                        "緊急通知"
                    ],
                    "is_pinned": true,
                    "allow_comments": true
                }
            },
            "ApiResponse": {
                "title": "API 回應",
                "description": "標準 API 回應格式，用於包裝所有 API 的成功回應",
                "required": [
                    "success"
                ],
                "properties": {
                    "success": {
                        "description": "操作是否成功",
                        "type": "boolean",
                        "example": true
                    },
                    "message": {
                        "description": "操作結果訊息",
                        "type": "string",
                        "example": "貼文建立成功"
                    },
                    "data": {
                        "description": "回應資料內容，根據不同 API 會有不同結構",
                        "oneOf": [
                            {
                                "$ref": "#/components/schemas/Post"
                            },
                            {
                                "type": "array",
                                "items": {
                                    "$ref": "#/components/schemas/Post"
                                }
                            },
                            {
                                "description": "其他類型的資料",
                                "type": "object"
                            }
                        ]
                    },
                    "meta": {
                        "description": "額外的元資料",
                        "properties": {
                            "timestamp": {
                                "type": "string",
                                "format": "date-time",
                                "example": "2025-01-15T10:30:00+08:00"
                            },
                            "request_id": {
                                "type": "string",
                                "example": "req_550e8400e29b41d4a716446655440000"
                            },
                            "version": {
                                "type": "string",
                                "example": "1.0.0"
                            }
                        },
                        "type": "object"
                    }
                },
                "type": "object",
                "example": {
                    "success": true,
                    "message": "貼文建立成功",
                    "data": {
                        "id": 123,
                        "title": "新的貼文標題",
                        "content": "貼文內容...",
                        "status": "published",
                        "created_at": "2025-01-15T10:30:00+08:00"
                    },
                    "meta": {
                        "timestamp": "2025-01-15T10:30:00+08:00",
                        "request_id": "req_550e8400e29b41d4a716446655440000",
                        "version": "1.0.0"
                    }
                }
            },
            "PaginatedResponse": {
                "title": "分頁回應",
                "description": "分頁資料的標準回應格式，包含資料項目和詳細的分頁資訊",
                "required": [
                    "data",
                    "pagination"
                ],
                "properties": {
                    "success": {
                        "description": "請求是否成功",
                        "type": "boolean",
                        "example": true
                    },
                    "data": {
                        "description": "當前頁的資料項目清單",
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/Post"
                        }
                    },
                    "pagination": {
                        "description": "詳細的分頁資訊",
                        "required": [
                            "current_page",
                            "per_page",
                            "total",
                            "total_pages"
                        ],
                        "properties": {
                            "current_page": {
                                "description": "目前頁碼（從 1 開始）",
                                "type": "integer",
                                "minimum": 1,
                                "example": 2
                            },
                            "per_page": {
                                "description": "每頁顯示筆數",
                                "type": "integer",
                                "maximum": 100,
                                "minimum": 1,
                                "example": 10
                            },
                            "total": {
                                "description": "總資料筆數",
                                "type": "integer",
                                "minimum": 0,
                                "example": 157
                            },
                            "total_pages": {
                                "description": "總頁數",
                                "type": "integer",
                                "minimum": 0,
                                "example": 16
                            },
                            "has_next": {
                                "description": "是否有下一頁",
                                "type": "boolean",
                                "example": true
                            },
                            "has_prev": {
                                "description": "是否有上一頁",
                                "type": "boolean",
                                "example": true
                            },
                            "first_page": {
                                "description": "第一頁頁碼",
                                "type": "integer",
                                "example": 1
                            },
                            "last_page": {
                                "description": "最後一頁頁碼",
                                "type": "integer",
                                "example": 16
                            },
                            "from": {
                                "description": "當前頁第一筆資料的序號",
                                "type": "integer",
                                "example": 11
                            },
                            "to": {
                                "description": "當前頁最後一筆資料的序號",
                                "type": "integer",
                                "example": 20
                            }
                        },
                        "type": "object"
                    },
                    "links": {
                        "description": "分頁導航連結",
                        "properties": {
                            "first": {
                                "type": "string",
                                "example": "/api/posts?page=1&limit=10",
                                "nullable": true
                            },
                            "last": {
                                "type": "string",
                                "example": "/api/posts?page=16&limit=10",
                                "nullable": true
                            },
                            "prev": {
                                "type": "string",
                                "example": "/api/posts?page=1&limit=10",
                                "nullable": true
                            },
                            "next": {
                                "type": "string",
                                "example": "/api/posts?page=3&limit=10",
                                "nullable": true
                            },
                            "self": {
                                "type": "string",
                                "example": "/api/posts?page=2&limit=10"
                            }
                        },
                        "type": "object"
                    }
                },
                "type": "object",
                "example": {
                    "success": true,
                    "data": [
                        {
                            "id": 11,
                            "title": "範例貼文標題 11",
                            "content": "貼文內容...",
                            "category": "general",
                            "status": "published",
                            "priority": "normal",
                            "created_at": "2025-01-15T10:30:00+08:00"
                        }
                    ],
                    "pagination": {
                        "current_page": 2,
                        "per_page": 10,
                        "total": 157,
                        "total_pages": 16,
                        "has_next": true,
                        "has_prev": true,
                        "first_page": 1,
                        "last_page": 16,
                        "from": 11,
                        "to": 20
                    },
                    "links": {
                        "first": "/api/posts?page=1&limit=10",
                        "last": "/api/posts?page=16&limit=10",
                        "prev": "/api/posts?page=1&limit=10",
                        "next": "/api/posts?page=3&limit=10",
                        "self": "/api/posts?page=2&limit=10"
                    }
                }
            },
            "PostRequest": {
                "title": "貼文請求",
                "description": "建立或更新貼文的通用請求資料",
                "type": "object",
                "allOf": [
                    {
                        "$ref": "#/components/schemas/CreatePostRequest"
                    }
                ]
            },
            "ValidationError": {
                "title": "驗證錯誤",
                "description": "表單或 API 請求資料驗證失敗時的詳細錯誤回應格式",
                "required": [
                    "success",
                    "error"
                ],
                "properties": {
                    "success": {
                        "description": "請求是否成功",
                        "type": "boolean",
                        "example": false
                    },
                    "error": {
                        "description": "主要錯誤訊息",
                        "type": "string",
                        "example": "資料驗證失敗"
                    },
                    "message": {
                        "description": "詳細錯誤描述",
                        "type": "string",
                        "example": "提交的資料包含驗證錯誤，請檢查以下欄位並重新提交"
                    },
                    "errors": {
                        "description": "各欄位的具體驗證錯誤訊息",
                        "type": "object",
                        "example": {
                            "title": [
                                "標題不能為空",
                                "標題長度不能超過 255 字元"
                            ],
                            "content": [
                                "內容不能為空",
                                "內容長度不能超過 10000 字元"
                            ],
                            "email": [
                                "電子郵件格式不正確"
                            ],
                            "password": [
                                "密碼長度至少需要 8 字元",
                                "密碼必須包含至少一個數字"
                            ],
                            "category": [
                                "分類必須是以下值之一：general, announcement, urgent, notice"
                            ]
                        },
                        "additionalProperties": {
                            "description": "該欄位的所有錯誤訊息列表",
                            "type": "array",
                            "items": {
                                "type": "string"
                            }
                        }
                    },
                    "code": {
                        "description": "HTTP 狀態碼",
                        "type": "integer",
                        "example": 400
                    },
                    "meta": {
                        "description": "額外的錯誤資訊",
                        "properties": {
                            "timestamp": {
                                "type": "string",
                                "format": "date-time",
                                "example": "2025-01-15T10:30:00+08:00"
                            },
                            "request_id": {
                                "type": "string",
                                "example": "req_550e8400e29b41d4a716446655440000"
                            },
                            "validation_rules": {
                                "description": "驗證規則參考",
                                "type": "object"
                            }
                        },
                        "type": "object"
                    }
                },
                "type": "object",
                "example": {
                    "success": false,
                    "error": "資料驗證失敗",
                    "message": "提交的資料包含驗證錯誤，請檢查以下欄位並重新提交",
                    "errors": {
                        "title": [
                            "標題不能為空",
                            "標題長度不能超過 255 字元"
                        ],
                        "content": [
                            "內容不能為空"
                        ],
                        "email": [
                            "電子郵件格式不正確"
                        ],
                        "password": [
                            "密碼長度至少需要 8 字元",
                            "密碼必須包含至少一個數字"
                        ]
                    },
                    "code": 400,
                    "meta": {
                        "timestamp": "2025-01-15T10:30:00+08:00",
                        "request_id": "req_550e8400e29b41d4a716446655440000"
                    }
                }
            },
            "Post": {
                "title": "貼文",
                "description": "貼文資料結構",
                "required": [
                    "id",
                    "title",
                    "content",
                    "status",
                    "created_at"
                ],
                "properties": {
                    "id": {
                        "description": "貼文ID",
                        "type": "integer",
                        "example": 1
                    },
                    "title": {
                        "description": "貼文標題",
                        "type": "string",
                        "maxLength": 255,
                        "example": "重要公告"
                    },
                    "content": {
                        "description": "貼文內容",
                        "type": "string",
                        "example": "這是一則重要公告內容"
                    },
                    "category": {
                        "description": "貼文分類",
                        "type": "string",
                        "enum": [
                            "general",
                            "announcement",
                            "urgent",
                            "notice"
                        ],
                        "example": "announcement"
                    },
                    "status": {
                        "description": "貼文狀態",
                        "type": "string",
                        "enum": [
                            "draft",
                            "published",
                            "archived"
                        ],
                        "example": "published"
                    },
                    "priority": {
                        "description": "優先級",
                        "type": "string",
                        "enum": [
                            "low",
                            "normal",
                            "high",
                            "urgent"
                        ],
                        "example": "normal"
                    },
                    "author_id": {
                        "description": "作者ID",
                        "type": "integer",
                        "example": 1
                    },
                    "created_at": {
                        "description": "建立時間",
                        "type": "string",
                        "format": "date-time",
                        "example": "2025-01-15T10:30:00Z"
                    },
                    "updated_at": {
                        "description": "更新時間",
                        "type": "string",
                        "format": "date-time",
                        "example": "2025-01-15T11:00:00Z"
                    },
                    "expires_at": {
                        "description": "過期時間",
                        "type": "string",
                        "format": "date-time",
                        "example": "2025-12-31T23:59:59Z",
                        "nullable": true
                    }
                },
                "type": "object"
            }
        }
    },
    "tags": [
        {
            "name": "attachments",
            "description": "attachments"
        },
        {
            "name": "auth",
            "description": "auth"
        },
        {
            "name": "posts",
            "description": "posts"
        },
        {
            "name": "health",
            "description": "health"
        }
    ]
}